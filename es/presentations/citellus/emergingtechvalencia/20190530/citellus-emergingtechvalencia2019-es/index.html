<!doctype html><html lang=en><head><meta charset=utf-8><title>Emerging Tech VLC'19 - Citellus - Automatizaci√≥n de comprobaciones</title><meta name=description content="A bunch of unrelated data"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../../../../../../reveal-js/dist/reset.css><link rel=stylesheet href=../../../../../../reveal-js/dist/reveal.css><link rel=stylesheet href=../../../../../../reveal-js/dist/theme/solarized.css id=theme><link rel=stylesheet href=../../../../../../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=citellus><a href=https://risuorg.github.io>Citellus</a>:</h2><h3 id=citellus---verifica-tus-sistemas>Citellus - Verifica tus sistemas!!</h3><p><img loading=lazy src=citellus.png></p><p><a href=https://risuorg.github.io>https://risuorg.github.io</a></p><p>Emerging Tech Valencia 2019: 30 Mayo</p></section><section><h2 id=qui√©n-soy>¬øQui√©n soy?</h2><ul><li>Pablo Iranzo G√≥mez (Pablo.Iranzo <em>AT</em> gmail.com)<ul><li>Senior Software Engineer - Solutions Engineering - Red Hat<ul><li>RHCA Level V: #110-215-852 (RHC{A,SS,DS,VA,E,SA,SP,AOSP}, JBCAA)</li></ul></li></ul></li><li>URLS<ul><li>blog: <a href=https://iranzo.io>https://iranzo.io</a></li><li><a href=https://linkedin.com/in/iranzo/>https://linkedin.com/in/iranzo/</a></li><li><a href=https://github.com/iranzo>https://github.com/iranzo</a></li><li><a href=https://twitter.com/iranzop>https://twitter.com/iranzop</a></li></ul></li></ul><p>Involucrado con Linux desde algo antes de comenzar los estudios universitarios y luego durante ellos, estando involucrado con las asociaciones LinUV y &lt;Valux.org>.</p><p>Empec√© a &lsquo;vivir&rsquo; del software libre en 2004 y a trabajar en Red Hat en 2006 como Consultor, luego como Senior Technical Account Manager, posteriormente como Principal Software Maintenance Engineer y actualmente como Senior Software Engineer para el equipo de Solutions Engineering.</p></section><section><h2 id=qu√©-es-citellus>¬øQu√© es Citellus?</h2><ul><li>Citellus es un framework acompa√±ado de scripts creados por la comunidad, que automatizan la detecci√≥n de problemas, incluyendo problemas de configuraci√≥n, conflictos con paquetes de versiones instaladas, problemas de seguridad o configuraciones inseguras y mucho m√°s.</li></ul></section><section><h2 id=historia-c√≥mo-comenz√≥-el-proyecto>Historia: ¬øc√≥mo comenz√≥ el proyecto?</h2><ul><li><p>Un fin de semana de guardia revisando una y otra vez la mismas configuraciones en diversos equipos hicieron evidente la necesidad de automatizar.</p></li><li><p>Unos scripts sencillos y un &lsquo;wrapper&rsquo; en <code>bash</code> despu√©s, la herramienta fue tomando forma, poco despu√©s, se reescribi√≥ el &lsquo;wrapper&rsquo; en python para proporcionarle caracter√≠sticas m√°s avanzadas.</p></li><li><p>En esos primeros momentos tambi√©n se mantuvieron conversaciones con ingenier√≠a y como resultado, un nuevo dise√±o de los tests m√°s sencillo fue adoptado.</p></li></ul></section><section><h2 id=qu√©-puedo-hacer-con-citellus>¬øQu√© puedo hacer con Citellus?</h2><ul><li>Ejecutarlo contra un sistema o contra un sosreport.</li><li>Resolver antes los problemas gracias a la informaci√≥n que proporciona.</li><li>Utilizar los plugins para detectar problemas actuales o futuros (ciclo de vida, etc).</li><li>Programar nuevos plugins en tu lenguaje de programaci√≥n preferido (bash, python, ruby, etc.) para extender la funcionalidad.<ul><li>Contribuir al proyecto esos nuevos plugins para beneficio de otros.</li></ul></li><li>Utilizar dicha informaci√≥n como parte de acciones proactivas en sus sistemas.</li></ul></section><section><h2 id=alg√∫n-ejemplo-de-la-vida-real>¬øAlg√∫n ejemplo de la vida real?</h2><ul><li>Por ejemplo, con Citellus puedes detectar:<ul><li>Borrados incorrectos de tokens de keystone</li><li>Par√°metros faltantes para expirar y purgar datos de ceilometer que pueden llevar a llenar el disco duro.</li><li>NTP no sincronizado</li><li>paquetes obsoletos que est√°n afectados por fallos cr√≠ticos o de seguridad.</li><li>otros! (860+) complementos en este momento, con m√°s de una comprobaci√≥n por plugin en muchos de ellos</li></ul></li><li>Cualquier otra cosa que puedas imaginar o programar üòâ</li></ul></section><section><h2 id=cambios-derivados-de-ejemplos-reales>Cambios derivados de ejemplos reales?</h2><ul><li>Inicialmente trabaj√°bamos con RHEL √∫nicamente (6, 7 y 8) por ser las soportadas</li><li>Dado que trabajamos con otros equipos internos como RHOS-OPS que utilizan por ejemplo <a href=https://www.rdoproject.org/>RDO project</a>, la versi√≥n upstream de Red Hat OpenStack, comenzamos a adaptar tests para funcionar en ambas.</li><li>A mayores, empezamos a crear funciones adicionales para operar sobre sistemas Debian y un compa√±ero estuvo tambi√©n enviando propuestas para corregir algunos fallos sobre Arch Linux.</li><li>Con la aparici√≥n de Spectre y Meltdown empezamos a a√±adir tambi√©n comprobaci√≥n de algunos paquetes y que no se hayan deshabilitado las opciones para proteger frente a dichos ataques.</li></ul></section><section><h2 id=algunos-n√∫meros-sobre-plugins>Algunos n√∫meros sobre plugins:</h2></section><section><h2 id=el-objetivo>El Objetivo</h2><ul><li>Hacer extremadamente sencillo escribir nuevos plugins.</li><li>Permitir escribirlos en tu lenguaje de programaci√≥n preferido.</li><li>Que sea abierto para que cualquiera pueda contribuir.</li></ul></section><section><h2 id=c√≥mo-ejecutarlo>C√≥mo ejecutarlo?</h2><p><img loading=lazy src=citellusrun.png></p></section><section><h2 id=a-destacar>A destacar</h2><ul><li>plugins en su lenguaje preferido</li><li>Permite sacar la salida a un fichero json para ser procesada por otras herramientas.<ul><li>Permite visualizar via html el json generado</li></ul></li><li>Soporte de playbooks Ansible (en vivo y tambi√©n contra un sosreport si se adaptan)<ul><li>Las extensiones (core, ansible), permiten extender el tipo de plugins soportado f√°cilmente.</li></ul></li><li>Salvar/restaurar la configuraci√≥n</li><li>Instalar desde pip/pipsi si no quieres usar el git clone del repositorio o ejecutar desde un contenedor.</li></ul></section><section><h2 id=interfaz-html>Interfaz HTML</h2><ul><li>Creado al usar &ndash;web, abriendo fichero <code>citellus.html</code> por http se visualiza.
<img loading=lazy src=www.png></li></ul></section><section><h2 id=por-qu√©-upstream>¬øPor qu√© upstream?</h2><ul><li>Citellus es un proyecto de c√≥digo abierto. Todos los plugins se env√≠an al repositorio en github para compartirlos (es lo que queremos fomentar, reutilizaci√≥n del conocimiento).<ul><li>Project on GitHub: <a href=https://github.com/citellusorg/citellus/>https://github.com/citellusorg/citellus/</a></li></ul></li><li>Cada uno es experto en su √°rea: queremos que todos contribuyan</li><li>Utilizamos un acercamiento similar a otros proyectos de c√≥digo abierto: usamos gerrit para revisar el c√≥digo y UnitTesting para validar la funcionalidad b√°sica.</li></ul></section><section><h2 id=c√≥mo-contribuir>¬øC√≥mo contribuir?</h2><p>Actualmente hay una gran presencia de plugins de OpenStack, ya que es en ese √°rea donde trabajamos diariamente, pero Citellus no est√° limitado a una tecnolog√≠a o producto.</p><p>Por ejemplo, es f√°cil realizar comprobaciones acerca de si un sistema est√° configurado correctamente para recibir actualizaciones, comprobar versiones espec√≠ficas con fallos (Meltdown/Spectre) y que no hayan sido deshabilitadas las protecciones, consumo excesivo de memoria por alg√∫n proceso, fallos de autentificaci√≥n, etc.</p><p>Lea la gu√≠a del colaborador en: <a href=https://github.com/citellusorg/citellus/blob/master/CONTRIBUTING.md>https://github.com/citellusorg/citellus/blob/master/CONTRIBUTING.md</a> para m√°s detalles.</p></section><section><h2 id=citellus-vs-otras-herramientas>Citellus vs otras herramientas</h2><ul><li><p>XSOS: Proporciona informaci√≥n de datos del sistema (ram, red, etc), pero no analiza, a los efectos es un visor &lsquo;bonito&rsquo; de informaci√≥n.</p></li><li><p>TripleO-validations: se ejecuta solamente en sistemas &rsquo;en vivo&rsquo;, poco pr√°ctico para realizar auditor√≠as o dar soporte.</p></li></ul></section><section><h2 id=por-qu√©-no-sosreports>¬øPor qu√© no sosreports?</h2><ul><li>No hay elecci√≥n entre una u otra, SOS recoge datos del sistema, Citellus los analiza.</li><li>Sosreport viene en los canales base de RHEL, Debian que hacen que est√© ampliamente distribuido, pero tambi√©n, dificulta el recibir actualizaciones frecuentes.</li><li>Muchos de los datos para diagn√≥stico ya est√°n en los sosreports, falta el an√°lisis.</li><li>Citellus se basa en fallos conocidos y es f√°cilmente extensible, necesita ciclos de desarrollo m√°s cortos, estando m√°s orientado a equipos de devops o de soporte.</li></ul></section><section><h2 id=qu√©-hay-bajo-el-cap√≥>¬øQu√© hay bajo el cap√≥?</h2><p>Filosof√≠a sencilla:</p><ul><li>Citellus es el &lsquo;wrapper&rsquo; que ejecuta.</li><li>Permite especificar la carpeta con el sosreport</li><li>Busca los plugins disponibles en el sistema</li><li>Lanza los plugins contra cada sosreport y devuelve el estado.</li><li>El framework de Citellus en python permite manejo de opciones, filtrado, ejecuci√≥n paralela, etc.</li></ul></section><section><h2 id=y-los-plugins>¬øY los plugins?</h2><p>Los plugins son a√∫n m√°s sencillos:</p><ul><li>En cualquier lenguaje que pueda ser ejecutado desde una shell.</li><li>Mensajes de salida a &lsquo;stderr&rsquo; (>&amp;2)</li><li>Si en bash se utilizan cadenas como $&ldquo;cadena&rdquo;, se puede usar el soporte incluido de i18n para traducirlos al idioma que se quiera.</li><li>Devuelve <code>$RC_OKAY</code> si el test es satisfactorio / <code>$RC_FAILED</code> para error / <code>$RC_SKIPPED</code> para los omitidos / Otro para fallos no esperados.</li></ul></section><section><h2 id=y-los-plugins-continuaci√≥n>¬øY los plugins? (continuaci√≥n)</h2><ul><li>Heredan variables del entorno como la carpeta ra√≠z para el sosreport (vac√≠a en modo Live) (<code>CITELLUS_ROOT</code>) o si se est√° ejecutando en modo live (<code>CITELLUS_LIVE</code>). No se necesita introducir datos v√≠a el teclado</li><li>Por ejemplo los tests en &lsquo;vivo&rsquo; pueden consultar valores en la base de datos y los basados en sosreport, limitarse a los logs existentes.</li></ul></section><section><h2 id=ejemplo-de-script>Ejemplo de script</h2><ul><li>Por ejemplo <a href=https://github.com/citellusorg/citellus/blob/master/citellus/plugins/system/disk_usage.sh>Uso de disco</a>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load common functions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>CITELLUS_BASE<span style=color:#e6db74>}</span><span style=color:#e6db74>/common-functions.sh&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> . <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>CITELLUS_BASE<span style=color:#e6db74>}</span><span style=color:#e6db74>/common-functions.sh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># description: error if disk usage is greater than $CITELLUS_DISK_MAX_PERCENT</span>
</span></span><span style=display:flex><span>: <span style=color:#e6db74>${</span>CITELLUS_DISK_MAX_PERCENT=75<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $CITELLUS_LIVE <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    is_required_file <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>CITELLUS_ROOT<span style=color:#e6db74>}</span><span style=color:#e6db74>/df&#34;</span>
</span></span><span style=display:flex><span>    DISK_USE_CMD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cat </span><span style=color:#e6db74>${</span>CITELLUS_ROOT<span style=color:#e6db74>}</span><span style=color:#e6db74>/df&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    DISK_USE_CMD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;df -P&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>$DISK_USE_CMD |awk -vdisk_max_percent<span style=color:#f92672>=</span>$CITELLUS_DISK_MAX_PERCENT <span style=color:#e6db74>&#39;/^\/dev/ &amp;&amp; substr($5, 0, length($5)-1) &gt; disk_max_percent { print $6,$5 }&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$result<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    exit $RC_FAILED
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    exit $RC_OKAY
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div></section><section><h2 id=listos-para-profundizar-en-los-plugins>¬øListos para profundizar en los plugins?</h2><ul><li>Cada plugin debe validar si debe o no ejecutarse y mostrar la salida a &lsquo;stderr&rsquo;, c√≥digo de retorno.</li><li>Citellus ejecutar√° e informar√° de los tests en base a los filtros usados.</li></ul></section><section><h2 id=requisitos>Requisitos:</h2><ul><li>El c√≥digo de retorno debe ser <code>$RC_OKAY</code> (ok), <code>$RC_FAILED</code> (fallo) or <code>$RC_SKIPPED</code> (omitido).</li><li>Los mensajes impresos a stderr se muestran si el plugin falla o se omite (si se usa el modo detallado)</li><li>Si se ejecuta contra un &lsquo;sosreport&rsquo;, la variable <code>CITELLUS_ROOT</code> tiene la ruta a la carpeta del sosreport indicada.</li><li><code>CITELLUS_LIVE</code> contiene <code>0</code> √≥ <code>1</code> si es una ejecuci√≥n en vivo o no.</li></ul></section><section><h2 id=c√≥mo-empezar-un-nuevo-plugin-por-ejemplo>¬øC√≥mo empezar un nuevo plugin (por ejemplo)?</h2><ul><li>Crea un script en <code>~/~/.../plugins/core/rhev/hosted-engine.sh</code></li><li><code>chmod +x hosted-engine.sh</code></li></ul></section><section><h2 id=c√≥mo-empezar-un-nuevo-plugin-continuaci√≥n>¬øC√≥mo empezar un nuevo plugin (continuaci√≥n)?</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$CITELLUS_LIVE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    grep -q ovirt-hosted-engine-ha $CITELLUS_ROOT/installed-rpms
</span></span><span style=display:flex><span>    returncode<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;x</span>$returncode<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;x0&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        exit $RC_OKAY
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;ovirt-hosted-engine no instalado&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        exit $RC_FAILED
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;No funciona en modo Live&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    exit $RC_SKIPPED
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div></section><section><h2 id=c√≥mo-empezar-un-nuevo-plugin-con-funciones>¬øC√≥mo empezar un nuevo plugin (con funciones)?</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e># Load common functions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>CITELLUS_BASE<span style=color:#e6db74>}</span><span style=color:#e6db74>/common-functions.sh&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> . <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>CITELLUS_BASE<span style=color:#e6db74>}</span><span style=color:#e6db74>/common-functions.sh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> is_rpm ovirt-hosted-engine-ha; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    exit $RC_OKAY
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;ovirt-hosted-engine no instalado&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    exit $RC_FAILED
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div></section><section><h2 id=c√≥mo-probar-un-plugin>¬øC√≥mo probar un plugin?</h2><ul><li><p>Use <code>tox</code> para ejecutar algunas pruebas UT (utf8, bashate, python 2.7, python 3)</p></li><li><p>Diga a Citellus qu√© plugin utilizar:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>[</span>piranzo@host citellus<span style=color:#f92672>]</span>$ ~/citellus/citellus.py sosreport-20170724-175510/crta02 -i hosted-engine.sh -r
</span></span><span style=display:flex><span>_________ .__  __         .__  .__
</span></span><span style=display:flex><span><span style=color:#ae81ff>\_</span>   ___ <span style=color:#ae81ff>\|</span>__|/  |_  ____ |  | |  |  __ __  ______
</span></span><span style=display:flex><span>/    <span style=color:#ae81ff>\ </span> <span style=color:#ae81ff>\/</span>|  <span style=color:#ae81ff>\ </span>  __<span style=color:#ae81ff>\/</span> __ <span style=color:#ae81ff>\|</span>  | |  | |  |  <span style=color:#ae81ff>\/</span>  ___/
</span></span><span style=display:flex><span><span style=color:#ae81ff>\ </span>    <span style=color:#ae81ff>\_</span>__|  <span style=color:#f92672>||</span>  | <span style=color:#ae81ff>\ </span> ___/|  |_|  |_|  |  /<span style=color:#ae81ff>\_</span>__ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> <span style=color:#ae81ff>\_</span>_____  /__<span style=color:#f92672>||</span>__|  <span style=color:#ae81ff>\_</span>__  &gt;____/____/____//____  &gt;
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>\/</span>              <span style=color:#ae81ff>\/</span>                     <span style=color:#ae81ff>\/</span>
</span></span><span style=display:flex><span>mode: fs snapshot sosreport-20170724-175510/crta02
</span></span><span style=display:flex><span><span style=color:#75715e># ~/~/.../plugins/core/rhev/hosted-engine.sh: failed</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ovirt-hosted-engine no instalado&#34;</span>
</span></span></code></pre></div></section><section><h2 id=qu√©-es-magui>¬øQu√© es Magui?</h2><h3 id=introducci√≥n>Introducci√≥n</h3><ul><li>Citellus trabaja a nivel de sosreport individual, pero algunos problemas se manifiestan entre conjuntos de equipos (cl√∫steres, virtualizaci√≥n, granjas, etc)</li></ul><p>Por ejemplo, Galera debe comprobar el seqno entre los diversos miembros para ver c√∫al es el que contiene los datos m√°s actualizados.</p></section><section><h3 id=qu√©-hace-magui->Qu√© hace M.a.g.u.i. ?</h3><ul><li>Ejecuta citellus contra cada sosreport o sistema, obtiene los datos y los agrupa por plugin.</li><li>Ejecuta sus propios plugins contra los datos obtenidos, destacando problemas que afectan al conjunto.</li><li>Permite obtener datos de equipos remotos via ansible-playbook.</li></ul></section><section><h2 id=qu√©-aspecto-tiene>¬øQu√© aspecto tiene?</h2><ul><li><p>Viene en el mismo repositorio que Citellus y se ejecuta especificando los diversos sosreports:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>[</span>piranzo@collab-shell<span style=color:#f92672>]</span>$ ~/citellus/magui.py * -i seqno
</span></span><span style=display:flex><span>    _
</span></span><span style=display:flex><span>_<span style=color:#f92672>(</span> <span style=color:#f92672>)</span>_  Magui:
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>_<span style=color:#f92672>(</span>√∏<span style=color:#f92672>)</span>_<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/<span style=color:#f92672>(</span>_<span style=color:#f92672>)</span>   Multiple Analisis Generic Unifier and Interpreter
</span></span><span style=display:flex><span><span style=color:#ae81ff>\|</span>
</span></span><span style=display:flex><span>|/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>....
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>piranzo@collab-shell<span style=color:#f92672>]]</span>$ cat magui.json:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#39;~/~/.../core/openstack/mysql/seqno.sh&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;controller0&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;err&#39;</span>: u<span style=color:#e6db74>&#39;2b65adb0-787e-11e7-81a8-26480628c14c:285019879\n&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;out&#39;</span>: u<span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;rc&#39;</span>: 10<span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>                                            <span style=color:#e6db74>&#39;controller1&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;err&#39;</span>: u<span style=color:#e6db74>&#39;2b65adb0-787e-11e7-81a8-26480628c14c:285019879\n&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;out&#39;</span>: u<span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;rc&#39;</span>: 10<span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>                                            <span style=color:#e6db74>&#39;controller2&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;err&#39;</span>: u<span style=color:#e6db74>&#39;2b65adb0-787e-11e7-81a8-26480628c14c:285019878\n&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;out&#39;</span>: u<span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                                                            <span style=color:#e6db74>&#39;rc&#39;</span>: 10<span style=color:#f92672>}}}</span>
</span></span></code></pre></div></li></ul><pre tabindex=0><code>
- En este ejemplo (UUID and SEQNO se muestra para cada controlador y vemos que el controller2 tiene una sequencia distinta y menos actualizada.

&lt;/small&gt;

----

## Siguientes pasos con Magui?

&lt;small&gt;

- Dispone de algunos plugins en este momento:
    - Agregan data de citellus ordenada por plugin para comparar r√°pidamente
    - Muestra los datos de &#39;metadatos&#39; de forma separada para contrastar valores
    - `pipeline-yaml`, `policy.json` y otros (asociados a OpenStack)
    - `seqno` de galera
    - `redhat-release` entre equipos
    - Faraday: compara ficheros que deban ser iguales o distintos entre equipos

&lt;/small&gt;

---

## Siguientes pasos

&lt;small&gt;

- M√°s plugins!
- Dar a conocer la herramienta para entre todos, facilitar la resoluci√≥n de problemas, detecci√≥n de fallos de seguridad, configuraciones incorrectas, etc.
- Movimiento: Muchas herramientas mueren por tener un √∫nico desarrollador trabajando en sus ratos libres, tener contribuciones es b√°sico para cualquier proyecto.
- Programar m√°s tests en Magui para identificar m√°s casos d√≥nde los problemas aparecen a nivel de grupos de sistemas y no a nivel de sistema sindividuales.

&lt;/small&gt;

---

## Otros recursos
Blog posts:

&lt;small&gt;

- [Citellus tagged posts](/es/tags/citellus/)
- [Citellus Framework for detecting known issues](/blog/2017/07/26/citellus-framework-for-detecting-known-issues-in-systems./)
- [Magui for analysis of issues across several hosts](/blog/2017/07/31/magui-for-analysis-of-issues-across-several-hosts./)

- [Jenkins for running CI tests](/blog/2017/08/17/jenkins-for-running-ci-tests/)

- [i18n and bash](/blog/2017/10/26/i18n-and-bash8-in-bash/)

- [Recent changes in Magui and Citellus](/blog/2018/01/16/recent-changes-in-magui-and-citellus/)

- [DevConf.cz 2018 recording](https://www.youtube.com/watch?v=SDzzqrUdn5A)

&lt;/small&gt;

---

### ¬øPreguntas?

Gracias por asistir!!

Ven a #citellus en Freenode, &lt;https://t.me/citellusUG&gt; en Telegram o contacta con nosotros:

- &lt;https://risuorg.github.io&gt;
- citellus _AT_ googlegroups.com
    - &lt;https://groups.google.com/forum/#!forum/citellus&gt;
- Issue en github &lt;https://github.com/citellusorg/citellus/issues&gt;

---

Presentaci√≥n disponible en:

&lt;https://iranzo.io&gt;

![](../../../../extra/blogqr.png)
</code></pre></section></div></div><script type=text/javascript src=../../../../../../reveal-hugo/object-assign.js></script><script src=../../../../../../reveal-js/dist/reveal.js></script><script type=text/javascript src=../../../../../../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../../../../../../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../../../../../../reveal-js/plugin/zoom/zoom.js></script><script type=text/javascript src=../../../../../../reveal-js/plugin/notes/notes.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams={},revealHugoPageParams={},revealHugoPlugins={plugins:[RevealMarkdown,RevealHighlight,RevealZoom,RevealNotes]},options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams),camelize(revealHugoPlugins));Reveal.initialize(options)</script></body></html>