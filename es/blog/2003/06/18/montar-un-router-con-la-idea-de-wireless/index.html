<!doctype html><html lang=es dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Montar un router con la idea de wireless | Pablo Iranzo G√≥mez blog</title><meta name=keywords content="linux,wireless,router,firewall,foss"><meta name=description content="Introducci√≥n
Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.
En el caso de las redes inal√°mbricas, existen varias aproximaciones.
Un nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red."><meta name=author content="Pablo Iranzo G√≥mez"><link rel=canonical href=https://iranzo.io/es/blog/2003/06/18/montar-un-router-con-la-idea-de-wireless/><meta name=google-site-verification content="Bk4Z5ucHLyPXqlZlj5LzANpYBBSvxqBW4E8i-Kwf-bQ"><meta name=yandex-verification content="993ede96cdfbee95"><link crossorigin=anonymous href=../../../../../../assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://iranzo.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://iranzo.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://iranzo.io/favicon-32x32.png><link rel=apple-touch-icon href=https://iranzo.io/apple-touch-icon.png><link rel=mask-icon href=https://iranzo.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=es href=https://iranzo.io/es/blog/2003/06/18/montar-un-router-con-la-idea-de-wireless/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZL9P943TP1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZL9P943TP1")}</script><meta property="og:url" content="https://iranzo.io/es/blog/2003/06/18/montar-un-router-con-la-idea-de-wireless/"><meta property="og:site_name" content="Pablo Iranzo G√≥mez blog"><meta property="og:title" content="Montar un router con la idea de wireless"><meta property="og:description" content="Introducci√≥n Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.
En el caso de las redes inal√°mbricas, existen varias aproximaciones.
Un nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red."><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2003-06-18T21:39:00+00:00"><meta property="article:modified_time" content="2023-08-25T09:45:44+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Wireless"><meta property="article:tag" content="Router"><meta property="article:tag" content="Firewall"><meta property="article:tag" content="Foss"><meta property="og:image" content="https://iranzo.io/mugshot.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://iranzo.io/mugshot.png"><meta name=twitter:title content="Montar un router con la idea de wireless"><meta name=twitter:description content="Introducci√≥n
Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.
En el caso de las redes inal√°mbricas, existen varias aproximaciones.
Un nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://iranzo.io/es/blog/"},{"@type":"ListItem","position":2,"name":"Montar un router con la idea de wireless","item":"https://iranzo.io/es/blog/2003/06/18/montar-un-router-con-la-idea-de-wireless/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Montar un router con la idea de wireless","name":"Montar un router con la idea de wireless","description":"Introducci√≥n Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.\nEn el caso de las redes inal√°mbricas, existen varias aproximaciones.\nUn nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red.\n","keywords":["linux","wireless","router","firewall","foss"],"articleBody":"Introducci√≥n Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.\nEn el caso de las redes inal√°mbricas, existen varias aproximaciones.\nUn nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red.\nUn aparato que realice dichas funciones no es especialmente asequible adem√°s de que est√° bastante limitado‚Ä¶\nLa soluci√≥n m√°s aceptada es utilizar un PC para que haga de nodo, teniendo as√≠ much√≠sima m√°s flexibilidad a la hora de configurarlo (m√°s problem√°tico tambi√©n, no es ‚Äúenchufar y listo‚Äù como con un AP de hardware).\nLas tarjetas a la venta en el mercado tienen tres modos de operaci√≥n:\nAd-hoc: Es el modo est√°ndar, en este tipo de modo de operaci√≥n, es el equivalente a las redes con Windows en las que se trabaja de igual a igual, todos son clientes y servidores. Managed: un servidor independiente (un AP) es el lugar al que se conectan todas las dem√°s tarjetas inal√°mbricas, el AP gestiona todas las conexiones, enrutados, etc. Master: Es el modo en el que trabaja el AP del punto anterior para que las tarjetas puedan trabajar como ‚ÄúManaged‚Äù. En redes con Windows s√≥lo es posible trabajar en los dos primeros modos, el Ad-Hoc y el Managed, para ello, como se ve, es necesario un AP por hardware que trabaje como Master al que las tarjetas que trabajan en Managed se puedan conectar. Y este es el punto en el que Linux marca la diferencia‚Ä¶ con Linux, existe un controlador (hostap) para las tarjetas basadas en Prism2 (p.ej. las Conceptronic). Con Linux y con esos controladores, es posible poner en modo Master las tarjetas de red (generalmente PCMCIA con un adaptador PCI para equipos de sobremesa) y de ese modo, hacer un AP por software.\nQuisiera expresar mi agradecimiento a Ghfjdksl de #wireless, a Jorti de #guadawireless y a Hilario y a Hawkmoon de #valenciawireless por la ayuda prestada para montar este nodo. Saludos tambi√©n al resto de gente de #valenciawireless por sus largu√≠simas tertulias ;P\nHardware\nPara la creaci√≥n del nodo, necesitaremos unos componentes de hardware tanto de software.\nEn la creaci√≥n del nodo de La Creu Wireless, el hardware es el siguiente:\nPlaca AT Pentium 120 500 Mb HD 420 Mb HD (porque lo ten√≠a a mano, pero posiblemente lo quite‚Ä¶ lo que menos quiero es que el ordenador haga m√°s ruido‚Ä¶) 64 mb Ram (iba a tener 16, pero a √∫ltima hora consegu√≠ m√°s‚Ä¶) Tarjeta gr√°fica ATI Mach 64 Pro Turbo PCI Ethernet ISA P‚Äôn‚ÄôP Intel PRO 10/10+ Ethernet PCI basada en Realtek 8029 (10 mbps) Ethernet PCI basada en Realtek 8139 (10/100) Ethernet ISA P‚Äôn‚ÄôP Compatible con NE 2000 Tarjeta wireless todav√≠a no la tengo, utilizo la ISA P‚Äôn‚ÄôP compatible con NE2000 como si fuese la wireless (A la que en la actualidad tengo conectado un USR2450 en modo bridge con LinuxAP) Tarjeta de sonido SB 16 P‚Äôn‚ÄôP (no se para qu√© porque no la tengo conectada ni nada, pero el caso es que como la ten√≠a‚Ä¶.) CD-ROM (instal√© desde disco duro porque no ten√≠a cd-rom en ese momento‚Ä¶ pero bueno.. ahora s√≠ ;)) RJ45 (latiguillos), uno directo para conectar al m√≥dem y a la eth0 y luego tres cruzados para conectar a cada uno de los pc‚Äôs sin necesidad de hub‚Ä¶ si tienes hub, pues todos directos y listo‚Ä¶ Se aceptan regalos ;) (Port√°tiles incluidos‚Ä¶ ;) )\nVolviendo a la realidad‚Ä¶ memoria le sobra por un tubo, pero bueno, puestos a ponerle, pues se le pone m√°s :)\nDisco duro me gustar√≠a ponerle m√°s, ya que como lo tengo que tener encendido todo el d√≠a para que sea un nodo ‚Äúfijo‚Äù, pues aprovechar y dejar las largas descargas baj√°ndose en ese ordenador.\nLo de las tarjetas de red puede asustar al principio‚Ä¶ pero bueno, tiene una clara explicaci√≥n‚Ä¶ en casa tengo dos ordenadores y ahora con el nodo tres, la conexi√≥n a Internet requiere otra tarjeta de red y no me permite compartirla directamente conect√°ndola a un HUB, as√≠ que me parec√≠a algo tonto el tener que gastarme dinero en un HUB cuando las tarjetas de red ya las ten√≠a‚Ä¶\nAs√≠ que el montaje de la falla es el siguiente:\nIntel Pro ISA 10/10+: eth0 conectada a mi conexi√≥n a Internet Realtek 8139 (10/100): eth1 conectada a mi equipo principal (tambi√©n con otra tarjeta 10/100, as√≠ que red local a 100 MBps ;) ) Realtek 8029: eth2 conectada al otro pc que tengo en casa (tambi√©n con una ethernet a 10 MBps) Isa P‚Äôn‚ÄôP NE2000: eth3 hace las labores de wireless hasta que tenga una de verdad (la utilizo para conectar otro equipo y hacer las pruebas como si estuviese conectado por wireless), en su momento ser√° utilizada para conexiones ‚Äútemporales‚Äù por cable, siendo entonces eth4 la wireless ‚Äúreal‚Äù. Realmente con un HUB podr√≠a quitar dos tarjetas de red del ordenador (ya que el ordenador principal y el secundario ir√≠an conectados al hub y no ser√≠an necesarias las tarjetas correspondientes y s√≥lo utilizar√≠a la otra que quedase para Internet y la otra para conectar al HUB (si mi conexi√≥n me permitiese hacerlo, hasta podr√≠a conectar mi m√≥dem al HUB y ahorrarme otra tarjeta.. pero bueno, el caso es que no se puede‚Ä¶)\nComo se puede ver, no digo nada de rat√≥n ni de monitor‚Ä¶ el caso es que realmente no es necesario porque para hacer la instalaci√≥n inicial se har√° conect√°ndolo a otro monitor, pero una vez puesto en marcha no har√° falta para nada, de hecho hasta el teclado sobrar√≠a, pero como he dicho que es un P120 con AT, en los casos en los que tengo que apagar o reiniciar la m√°quina necesito algo que no implique un reset total (o sea, necesito tres teclas: CTRL-ALT-SUPR).\nEl teclado que tengo es uno de 84 teclas que ser√° como un teclado normal pero sin el bloque num√©rico y sin el bloque de av-pag, etc de tama√±o, tiene s√≥lo dos leds, Bloq may y bloq despl, pero lo dicho‚Ä¶ sobra ;)\nAhora el ordenador es un P200 MMX con 128 Mb de RAM, las tarjetas son una Intel Pro ISA 10/10+, una SMC 100, 3Com 3c509 y NE2000, discos tiene uno de 10 Gb, y otro de 20, configurados como:\n128 Mb Swap 10 Mb boot 3 Gb sistema, usuarios Resto = 26 Gb para descargas diversas‚Ä¶ (pero con √°nimo educativo, no os vayais a pensar‚Ä¶) Ahora vamos a la configuraci√≥n del software‚Ä¶\nSistema Operativo y Paquetes El primer paso previo a todos, es que una vez configurado el hardware para que no se queje (IRQ‚Äôs, puertos IO, etc) (si la placa es realmente P‚Äôn‚ÄôP no habr√° problemas pero la m√≠a aunque es P‚Äôn‚ÄôP dio algunos problemas as√≠ que‚Ä¶ ajo y agua‚Ä¶) Si has de comprar tarjetas y puedes, c√≥mpralas PCI y mejor todav√≠a si compras un HUB porque as√≠ no tienes que tener el ordenador rellenito en todas sus ranuras con ethernets ;).\nLo primero a configurar entonces es la BIOS.\nComo cada BIOS es de un pap√° y de una mam√° distintos (aunque a veces la mam√° sea siempre Award o Ami), dar√© la explicaci√≥n general y que cada uno se las apa√±e con el manual de su placa base para hacer lo que digo‚Ä¶\nPD: Si no sabes lo que es la BIOS, olv√≠date de seguir‚Ä¶ esto no est√° hecho para t√≠‚Ä¶ Mucho mejor que veas esto.\nConfigura las tarjetas en el orden que quieras, pero ten bien claro cu√°l ser√° cada una (si son todas iguales pues ser√° m√°s problem√°tico, pero no por ello imposible).\nPrimero pon el ordenador en fecha y hora, y en la opci√≥n que pone ‚ÄúHalt on‚Äù ponle que nada, es decir, que bajo ning√∫n concepto el ordenador no arranque (por ejemplo por falta de teclado, falta de monitor, etc porque al fin y al cabo luego no lo tendr√°‚Ä¶)\nEn la BIOS dile que de PNP su t√≠a‚Ä¶ le dices que el sistema operativo no es P‚ÄôN‚ÄôP y que no se maree (puedes probar diciendo que s√≠, no deber√≠a ser muy tortuoso y si lo es, siempre lo puedes cambiar otra vez ;))\nComo dispositivo de arranque se le pondr√° primero la disquetera, pero en el momento en que todo est√© configurado, se pondr√° fijo siempre el disco duro.\nSi la placa es ATX, dile que tras un corte de luz, que se encienda sola‚Ä¶ as√≠ evitar√°s los tiempos de apag√≥n del nodo al m√≠nimo.\nSalva todos los cambios y reiniciar√° el ordenador‚Ä¶ En mi caso, como no ten√≠a en un primer momento ni disquetera ni cd-rom, aprovech√© que el disco duro conten√≠a un Windows 95 y baj√© la imagen de CD-ROM de instalaci√≥n de Internet de Debian Potato, la convert√≠ del .ISO a carpetas y directorios normales y la guard√© por la red en el segundo HD del ordenador.\nLa imagen iso son unos 30 Mb y la descargu√© de la p√°gina de Debian. (woody_netinst-20020626-i386.iso)\nLa decisi√≥n de tomar ‚ÄúDebian‚Äù como sistema a instalar fue sencilla (lo de que ten√≠a que ser Linux estaba cantado por lo explicado en la introducci√≥n):\nRed Hat Linux: Est√° muy bien, de hecho es con la que m√°s experiencia tengo, la tengo funcionando desde el a√±o 96 en un servidor y me va genial, poquitos problemas excepto actualizaciones, etc (aunque con las nuevas herramientas es muy f√°cil). Las actualizaciones, en el momento de lanzarlas, si hay muchos clientes de pago, pues a los que no pagamos, pues ajo y agua y a esperarse a que no est√© tan saturado‚Ä¶ el formato de Red Hat, el RPM es el est√°ndar m√°s extendido. (Se puede bajar de internet en versi√≥n libre, llamada Fedora Core, o bien en cl√≥nicas basadas en RHEL). SuSE Linux: Est√° muy bien, si compras la distribuci√≥n, tienes muchos cd‚Äôs con programas, manuales, etc Bastante bien adaptada al Espa√±ol (je, je), etc‚Ä¶ Pero no se puede bajar la versi√≥n completa de internet porque tiene programas con licencias de distribuci√≥n que no lo permiten, s√≥lo si se compra. Utiliza el RPM que es un punto a favor, pero en contra es que no es compatible al 100% con las estructuras de directorios y funcionamientos de Red Hat, as√≠ que no hay forma de distinguir si ese RPM funcionar√° bien o no con SuSE. El peor inconveniente es la gran cantidad de recursos que necesita, tanto de RAM para la instalaci√≥n como para el almacenamiento en disco (la m√≠nima son unos 500 mb (pero m√≠nima m√≠nima m√≠nima‚Ä¶)). La ventaja es que la configuraci√≥n es toda en modo gr√°fico, con una autodetecci√≥n genial, etc. Ten√≠a experiencia con ella tanto de gastarla en casa como distribuci√≥n Linux, en la uni en un servidor como de haber colaborado en su traducci√≥n de manuales y de software de configuraci√≥n. Debian: No tenia ni puta idea de ella, una vez que la intent√© instalar casi me da algo con el programa de selecci√≥n de paquetes a instalar (dselect de la Potato). La instalaci√≥n es en modo texto. Tiene un sistema de actualizaci√≥n/instalaci√≥n bastante bueno en modo texto. la decisi√≥n fue usar Debian‚Ä¶ de paso que aprend√≠a a gastarla, al ser en modo texto, ten√≠a el aliciente de que facilita su administraci√≥n remota (recordemos que el ordenador una vez instalado m√≠nimamente no iba a tener ni teclado ni rat√≥n ni monitor ni naa de na‚Ä¶ excepto el cable de la luz y cuatro cables RJ45 para las tarjetas de red :)) Vale, como ya he comentado, en el nodo, en el momento de su creaci√≥n no ten√≠a ni disquetera ni CD-ROM, as√≠ que se copiaron los archivos a una instalaci√≥n de Windows 95, se reinicia en modo-MS-DOS y una vez en el, se cambia al directorio donde se extrajo la imagen de cd y se ejecuta el programa de instalaci√≥n‚Ä¶\nSi tienes grabadora y cd-rom en el nodo pues lo m√°s sencillo es bajar la iso, grabarla a un CD y arrancar desde el CD-ROM (en la bios se puede configurar esa opci√≥n).\nComo ya he dicho, la imagen de instalaci√≥n es una NETINST, es decir, 30 mb m√≠nimos que se utilizan para una vez respondidas unas preguntas copiar un sistema b√°sico que se puede conectar a Internet y seguir bajando el resto de Internet‚Ä¶ (Tengo una conexi√≥n a 128 kbps, as√≠ que que nadie me diga que es una locura porque es viable‚Ä¶)\nCuando yo hice la instalaci√≥n, la netinst m√°s habitual era la potato, pero hace nada que pasaron a Woody (3.0), el caso es que m√°s o menos son parecidas y de hecho una vez instal√© lo m√≠nimo hice el cambio a Woody usando el programa que lleva para hacerlo‚Ä¶\nNo voy a explicar la instalaci√≥n de Debian porque esto habla de configurar un nodo, no de instalar Linux, pero bueno, b√°sicamente consisti√≥ en particionar el HD, crear una partici√≥n swap de 40 Mb (ya dije que mi disco duro era peque√±ito..) y una de datos de 472 Mb como ext3 Es conveniente pensar un nombre para el nodo‚Ä¶la norma habitual, al menos en universidades, etc es ponerle nombres de estrellas o de cient√≠ficos, pero bueno‚Ä¶ Cada uno que le ponga el que le de la gana‚Ä¶\nSe configura el teclado, la tarjeta de red (como tengo Internet por tarjeta de cable fue tan sencillo como decirle que cargase los m√≥dulos de las tarjetas de red (en el caso de las ISA indicando tambi√©n la IO) y luego en la que estaba conectada a Internet, decirle que hiciese configuraci√≥n autom√°tica por DHCP y ya estaba la conexi√≥n funcionando‚Ä¶\nEn la selecci√≥n de paquetes puse lo m√≠nimo m√≠nimo, as√≠ que al ratito y tras un rearranque, me pidi√≥ asignar contrase√±as y crear un usuario (no es recomendable estar siempre como administrador para trabajar con Linux‚Ä¶)\nVale, llegados a este punto, tenemos ya el Linux instalado y tenemos delante la consola para iniciar sesi√≥n en el sistema. Vamos a necesitar varios programas adem√°s de los b√°sicos para trabajar con el nodo‚Ä¶ si nos gusta Linux, pues nos gustar√° instalar alguno m√°s, pero bueno‚Ä¶ por un lado est√°n los b√°sicos y los recomendados‚Ä¶\nComo lo que estoy haciendo es explicar la configuraci√≥n de lo que yo hice con mi ordenador, pues all√° vamos:\nPara la wireless hace falta el wavemon que es un monitor de estado de la tarjeta y el zebra para enrutar din√°micamente.\nEn mi caso, ya que ese ordenador iba a hacer de medio ‚Äúservidor‚Äù en mi casa, pues me interes√≥ ponerle:\nsamba: para compartir archivos e impresoras en un formato compatible con Windows y as√≠ poder luego bajar archivos de un ordenador a otro (del principal al nodo) mediante el entorno de red pptpd: para permitir conexiones VPN, permite que desde internet (o en este caso, desde la wireless), se pueda conectar con el nodo, y se asigne otra direcci√≥n IP que permita hacer otras cosas que de normal no se podr√≠a‚Ä¶ En mi caso, tengo limite de descarga en Internet y aunque por el momento no lo apliquen no quita que pudieran hacerlo‚Ä¶ causa pues de que no comparta mi acceso a Internet a no ser que conozca directamente al equipo que se conecta‚Ä¶ es decir, una vez conectado mediante la wireless, har√° una conexi√≥n VPN desde su Windows o su Linux al nodo y mediante un login y un pass tendr√° acceso a Internet a trav√©s del nodo, que de otra forma no tendr√≠a‚Ä¶) (un nodo no tiene que necesariamente tener acceso a Internet, pero es recomendable para unir los nodos y facilitar la integraci√≥n en la red, etc) webmin: es un programa hecho por caldera y que funciona en multitud de plataformas y distribuciones, permite muy f√°cilmente configurar desde un navegador much√≠simas cosas del sistema. No digo que vaya a reemplazar a la configuraci√≥n en modo consola, pero para muchas cosas es much√≠simo m√°s f√°cil hacerlo desde navegador que tener que entrar, etc‚Ä¶ Otros paquetes instalados (muchos de ellos se instalan solitos como dependencias a los ya instalados‚Ä¶): A ver, en resumen, interesa instalar el ssh porque con el podremos entrar desde fuera al servidor, el webmin y los m√≥dulos listados arriba, etc\nLo dicho, esto es lo que yo tengo puesto‚Ä¶ los paquetes se instalan poniendo:\napt-get install por ejemplo: apt-get install wavemon zebra webmin-stunnel webmin-status wget vtun\nAutom√°ticamente el programa se conectar√° a Internet y comenzar√° a bajar esos paquetes y todos los necesarios para que esos funcionen, es decir, si instalas webmin-status, para eso te har√° falta primero el webmin y el programa lo instalar√° tambi√©n solito tras pedir confirmaci√≥n e indicar los megas a descargar y lo que ocupar√° una vez descomprimido.\nRed Vale, se supone que ahora ya tenemos el sistema funcionando y bueno‚Ä¶ algo es algo :) ahora viene lo serio‚Ä¶ configurarlo para que se adapte a nuestras necesidades‚Ä¶\nLo primero es tener un Kernel modernito (a mi con el est√°ndar no me iba, pero como ver√©is en la lista de paquetes con el 2.4 funciona bastante bien el P‚ÄôN‚ÄôP)\nTenemos que por un lado configurar las tarjetas de red: Para eso, entramos en /etc/modutils como root y tendremos varios archivos de configuraci√≥n, para ser representativo pondr√© el de una tarjeta ISA que son los m√°s dif√≠ciles:\nContenido de : /etc/modutils/eepro\noptions eepro io=0x210 Como ver√©is es altamente jodid√≠simo configurar una tarjeta de red‚Ä¶ s√≥lo indicando el puerto de entrada salida Linux ya le busca la IRQ apropiada (en casos chungos, se le puede indicar tambi√©n) Con el resto de tarjetas editaremos los ficheros para ver que est√° todo bien y los llamaremos con el nombre del m√≥dulo necesario (sale durante la instalaci√≥n o en p√°ginas de ayuda) Luego, editaremos el fichero /etc/modules y pondremos las tarjetas en el orden en el que queremos que se llamen:\n# /etc/modules: kernel modules to load at boot time. # # This file should contain the names of kernel modules that are # to be loaded at boot time, one per line. Comments begin with # a \"#\", and everything on the line after them are ignored. unix af_packet eepro tulip 3c59x ne sb Es decir, primero se cargar√° la EtherExpress Pro 10/10+ de Intel, que se llamar√° eth0 (tal como se explic√≥ en el apartado de hardware), luego la 8139 (10/100) como eth2, luego la ne2000 PCI (RTL 8029), luego la Novel 2000 ISA y por √∫ltimo la SoundBlaster‚Ä¶\nEn el caso de haber dos tarjetas con el mismo controlador, se ir√°n creando consecutivamente‚Ä¶ es decir, si hay dos RTL8029, pues ser√°n eth1 y eth2 y as√≠ el resto‚Ä¶ en mi caso como cada una es distinta no tuve ese ‚Äúproblema‚Äù.\nTras editar ese fichero, tendremos que hacer que al siguiente arranque se tome esta configuraci√≥n, as√≠ que ejecutaremos update-modules, para que el ordenador cree el /etc/modules.conf adecuado conforme a nuestros deseos., al siguiente arranque tendremos algo como:\nReal Time Clock Driver v1.10e id: 0xb4 \u003c7\u003e io: 0x210 \u003c6\u003eeth0: Intel EtherExpress Pro/10+ ISA at 0x210,\u003c6\u003e 00\u003c6\u003e:aa\u003c6\u003e:00\u003c6\u003e:c9\u003c6\u003e:9d\u003c6\u003e:1a\u003c6\u003e, IRQ 11, 10BaseT. eepro.c: v0.13 11/08/2001 aris@cathedrallabs.org 8139too Fast Ethernet driver 0.9.24 eth1: RealTek RTL8139 Fast Ethernet at 0xc486b000, 00:50:fc:4d:c7:d9, IRQ 9 eth1: Identified 8139 chip type ‚ÄôRTL-8139C‚Äô ne2k-pci.c:v1.02 10/19/2000 D. Becker/P. Gortmaker http://www.scyld.com/network/ne2k-pci.html eth2: RealTek RTL-8029 found at 0x6100, IRQ 9, 00:C0:DF:E3:46:F9. isapnp: Scanning for PnP cards... isapnp: Calling quirk for 01:00 isapnp: SB audio device quirk - increasing port range isapnp: Card ‚ÄôCreative SB16 PnP‚Äô isapnp: 1 Plug \u0026 Play card detected total ne.c:v1.10 9/23/94 Donald Becker (becker@scyld.com) Last modified Nov 1, 2000 by Paul Gortmaker NE*000 ethercard probe at 0x340: 00 40 33 94 ad 7d eth3: NE2000 found at 0x340, using IRQ 10. Soundblaster audio driver Copyright (C) by Hannu Savolainen 1993-1996 sb: Creative SB16 PnP detected sb: ISAPnP reports ‚ÄôCreative SB16 PnP‚Äô at i/o 0x220, irq 5, dma 1, 5 SB 4.13 detected OK (220) sb: 1 Soundblaster PnP card(s) found. Como vemos, ya ha ido asignando tarjetas.. eth0 la Intel, eth1 la 8139, eth2 la 8029 y eth3 la Ne2000, lo de la SoundBlaster es accesorio, pero mola que la pille el solito ;) (con un kernel de la 2.4 aviso‚Ä¶)\nAhora falta configurar las direcciones para cada tarjeta‚Ä¶ editamos el fichero /etc/network/interfaces:\n# The first network card - this entry was created during the Debian installation auto eth0 iface eth0 inet dhcp auto eth1 iface eth1 inet static address 1.1.1.1 netmask 255.255.255.0 auto eth2 iface eth2 inet static address 1.1.2.1 netmask 255.255.255.0 auto eth3 iface eth3 inet static address 10.34.12.129 netmask 255.255.255.224 #auto eth3 #iface eth3 inet static # address 1.1.3.1 # netmask 255.255.255.0 Esto en cristiano viene a decir que cargue las tarjetas en el arranque (auto eth?), y lo de abajo, pues c√≥mo configurarlas‚Ä¶ la eth0 es la que estaba conectada a internet, por lo tanto como mi proveedor configura por DHCP, pues eso pone‚Ä¶ la eth1 es la de mi red local con el primero ordenador, le asigna una ip 1.1.1.1 y una m√°scara de subred de tipo C.\nEn realidad la direcci√≥n 1.1.1.1 est√° asignada en internet y ser√≠a una cabronada el conectarme con eso configurado as√≠, pero como hemos dicho, es una red local y no tiene porqu√© afectar a nadie, as√≠ que as√≠ se queda‚Ä¶\nCon la segunda para la red local, pues lo mismo, pero con otra direcci√≥n 1.1.2.1 y con subred de tipo C y la ethernet 3 es lo que ser√≠a la wireless y le asigno una direcci√≥n real y v√°lida, en mi caso, esta ip pertenece a Valencia Wireless y est√° asignada a mi nodo, cada uno que consulte en http://www.redlibre.net el direccionamiento y que se ponga encargado con el responsable de su zona si lo hay y si no, directamente con Redlibre‚Ä¶\nAhora, al arrancar el ordenador que hace de nodo, ya deber√≠a coger autom√°ticamente esos datos para cada tarjeta y funcionar as√≠ bien‚Ä¶\nMe pod√©is preguntar que porqu√© asigno la 1.1.1.1 a una y la 1.1.2.1 a dos tarjetas que pertenecen a la misma red local‚Ä¶ lo ideal ser√≠a 1.1.1.2, pero luego ten√≠a problemas con el DHCP (con un hub nunca hubiera pasado‚Ä¶ pero como nadie me ha dado ninguno‚Ä¶) (luego se ver√° el motivo)\nEl siguiente paso, es que ya puestos, que el ordenador asigne direcciones a los ordenadores que se conecten de forma autom√°tica, es decir.. montar un servidor DHCP‚Ä¶ para ello instalaremos el paquete DHCP y el servidor de nombres BIND, para que los equipos remotos que se conecten puedan pedir configuraci√≥n autom√°ticamente y que puedan resolver nombres‚Ä¶\nEl fichero de configuraci√≥n del DHCP es el siguiente: (/etc/dhcp3/dhcp.conf):\n# # Sample configuration file for ISC dhcpd # ddns-updates on; use-host-decl-names on; allow unknown-clients; default-lease-time 3600; max-lease-time 7200; authoritative; subnet 10.34.12.128 netmask 255.255.255.224 option domain-name-servers 10.34.12.129; range 10.34.12.131 10.34.12.158; option broadcast-address 10.34.12.159; option routers 10.34.12.129; subnet 192.168.1.0 netmask 255.255.255.0 option domain-name-servers 192.168.1.1; range 192.168.1.2 192.168.1.254; option broadcast-address 192.168.1.255; option routers 192.168.1.1; subnet 1.1.1.0 netmask 255.255.255.0 option domain-name-servers 1.1.1.1; option domain-name alufis; range 1.1.1.3 1.1.1.254; option broadcast-address 1.1.1.255; option routers 1.1.1.1; option netbios-name-servers 1.1.1.1; option netbios-node-type 8; subnet 1.1.2.0 netmask 255.255.255.0 option domain-name alufis; option netbios-name-servers 1.1.2.1; option netbios-node-type 8; option domain-name-servers 1.1.2.1; range 1.1.2.3 1.1.2.254; option broadcast-address 1.1.2.255; option routers 1.1.2.1; subnet 1.1.3.0 netmask 255.255.255.0 option domain-name-servers 1.1.3.1; option domain-name alufis; range 1.1.3.3 1.1.3.254; option broadcast-address 1.1.3.255; option routers 1.1.3.1; option netbios-name-servers 1.1.3.1; option netbios-node-type 8; host deneb option host-name \"deneb\"; hardware ethernet 00:04:e2:33:4e:8d; fixed-address 1.1.1.2; server-name \"deneb\"; host darkstar option host-name \"darkstar\"; hardware ethernet 00:80:c8:16:de:59; server-name \"darkstar\"; fixed-address 1.1.2.2; host Alnilam option host-name \"alnilam\"; hardware ethernet 00:90:d1:06:57:dc; fixed-address 10.34.12.130; server-name \"alnilam\"; A ver‚Ä¶ por partes‚Ä¶\nPrimero defino lo que ser√° la wireless, con la ip asignada, la subred, el rango de ip‚Äôs, etc‚Ä¶\nsubnet 10.34.12.128 netmask 255.255.255.224 option domain-name-servers 10.34.12.129; range 10.34.12.130 10.34.12.158; option broadcast-address 10.34.12.159; option routers 10.34.12.129; Esto viene a significar que la red 10.34.12.128 (valencia wireless, mi nodo), con m√°scara de subred (255.255.255.224), tiene un servidor de nombres situado en 10.34.12.129 (la asignada a eth3), una direcci√≥n de broadcast en .158 y un router en .129 (el mismo que el DNS, es decir, el nodo‚Ä¶).\nEl rango de ip‚Äôs asignado van desde la siguiente al nodo (.33) hasta el .62 de esa forma los clientes que pidan configuraci√≥n por DHCP por el interfaz con esa subred (eth3) obtendr√°n una IP dentro de ese rango‚Ä¶\n192.168.. son direcciones para redes privadas y en este caso la utilizar√© para los equipos que se conecten mediante la VPN, es decir, equipos que primero se conectan por la wireless y luego se conectan mediante VPN, realmente no creo que fuese necesario indicarlo, pero lo prefiero as√≠ :)\nLuego vienen definidas las redes para las tarjetas locales 1.1.1.1 y 1.1.2.1, si ambas tarjetas estuviesen en la misma red, con una sola definici√≥n bastar√≠a, pero el problema ser√≠a que si a la 1.1.1.3 que se conecta por la segunda tarjeta de red con IP 1.1.1.2 le digo que el router es 1.1.1.1 que es la primera tarjeta de red, pues habr√≠an problemas‚Ä¶ no ir√≠a ni a tiros‚Ä¶ esto con un HUB no pasa y no hace falta poner estas dos definiciones, pero en mi caso s√≠‚Ä¶ as√≠ cada una es una red distinta que va bien y asigna ip‚Äôs autom√°ticamente y resuelve nombres.\nLuego vienen dos declaraciones de equipo, en mi caso, a mis dos equipos de casa, les asigno ip‚Äôs fijas, porque no me van a hacer falta m√°s (de hecho no har√≠a falta ni el dhcp para ellas, pero bueno, puestos a hacerlo a lo grande‚Ä¶ pues ya lo tengo listo para un d√≠a meter dos hubs y poder conectar tropocientos ordenadores en cada tarjeta de red ;))\nPara asignar IP fija, se hace en base a la direcci√≥n MAC de la tarjeta de red, que son esos c√≥digos en hexadecimal.\nEn el √∫ltimo caso defino otro ordenador pero sin ip fija (en su momento ir√° por la wireless y por eso no tiene nada puesto)\nRespecto al servidor de nombres‚Ä¶ no hice nada, s√≥lo instal√© el paquete y ya iba, as√≠ que no toqu√© nada :)\nHasta este punto los equipos cliente que se configuren para que pidan la configuraci√≥n autom√°ticamente, recibir√°n una configuraci√≥n v√°lida desde nuestro nodo, ahora s√≥lo falta hacer alguna cosilla m√°s ;)\nMasquerading Tenemos un servidor DHCP, las tarjetas configuradas y un servidor de nombres‚Ä¶ ahora s√≥lo falta que enrute!!! de esa forma tendremos acceso a Internet desde cualquiera de nuestros ordenadores‚Ä¶\nPara ello, si leemos el IP-MASQUERADING-HOWTO, sacaremos este interesante script:\n#!bash #!/bin/sh # # rc.firewall-2.4 FWVER=0.63 # # Initial SIMPLE IP Masquerade test for 2.4.x kernels using IPTABLES. # # Once IP Masquerading has been tested, with this simple ruleset, it is highly recommended to use a stronger IPTABLES ruleset either given later in this HOWTO or from another reputable resource. # Log: # 0.63 - Added support for the IRC IPTABLES module # 0.62 - Fixed a typo on the MASQ enable line that used eth0 instead of $EXTIF # 0.61 - Changed the firewall to use variables for the internal and external interfaces. # 0.60 - 0.50 had a mistake where the ruleset had a rule to DROP all forwarded packets but it didn‚Äôt have a rule to ACCEPT any packets to be forwarded either - Load the ip_nat_ftp and ip_conntrack_ftp modules by default # 0.50 - Initial draft # echo -e \"\\n\\nLoading simple rc.firewall version $FWVER..\\n\" # The location of the ‚Äôiptables‚Äô program IPTABLES=/sbin/iptables EXTIF=\"eth0\" EXTIF2=\"eth3\" EXTIF3=\"sl+\" INTIF=\"eth1\" INTIF2=\"eth2\" INTIF3=\"ppp+\" LAN1=\"1.1.1.0/16\" echo \" External Interface : $EXTIF\" echo \" External Interface 2 : $EXTIF2\" echo \" External Interface 3 : $EXTIF3\" echo \" -----------------------------\" echo \" Internal Interface : $INTIF\" echo \" Internal Interface 2 : $INTIF2\" echo \" Internal Interface 3 : $INTIF3\" echo \" -----------------------------\" echo \" Internal Network : $LAN1\" echo \" enabling forwarding..\" echo \"1\" \u003e /proc/sys/net/ipv4/ip_forward echo \" enabling DynamicAddr..\" echo \"1\" \u003e /proc/sys/net/ipv4/ip_dynaddr # Borrar reglas anteriores tanto en normal como en nat y por defecto no enrutar $IPTABLES -t nat -F $IPTABLES -F $IPTABLES -P FORWARD DROP #Conectar la red local para transferencia de datos $IPTABLES -A FORWARD -s $LAN1 -d $LAN1 -j ACCEPT #Pasar datos desde las locales a inet $IPTABLES -A FORWARD -s $LAN1 -o $EXTIF -j ACCEPT # Aceptar paquetes de entrada a la local $IPTABLES -A FORWARD -i $EXTIF -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT # Enmascarar a internet $IPTABLES -t nat -A POSTROUTING -o $EXTIF -j MASQUERADE #Pasar datos desde las locales a la wireless $IPTABLES -A FORWARD -s $LAN1 -o $EXTIF2 -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF2 -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT # Enmascarar a la wireless $IPTABLES -t nat -A POSTROUTING -s $LAN1 -o $EXTIF2 -j MASQUERADE #Entrada de la red local a los t√∫neles wireless (sl+) $IPTABLES -A FORWARD -s $LAN1 -o $EXTIF3 -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF3 -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT # Enmascarar a los t√∫neles $IPTABLES -t nat -A POSTROUTING -s $LAN1 -o $EXTIF3 -j MASQUERADE #Paquetes de entrada entre las wireless y los t√∫neles Wireless (sl+) $IPTABLES -A FORWARD -i $EXTIF2 -o $EXTIF3 -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF3 -o $EXTIF2 -j ACCEPT # Paquetes de entrada de la VPN a internet y a la wireless $IPTABLES -A FORWARD -i $INTIF3 -o $EXTIF -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF -o $INTIF3 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT $IPTABLES -A FORWARD -i $INTIF3 -o $EXTIF2 -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF2 -o $INTIF3 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT # Programas #------------------------------------------ # Proxy Transparente echo \"Transparent Proxy for SQUID\" $IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport 80 -j REDIRECT ‚Äîto-port 3128 -d ! $LAN1 $IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport 25 -j REDIRECT ‚Äîto-port 25 -d ! $LAN1 $IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport 110 -j REDIRECT ‚Äîto-port 110 -d ! $LAN1 # Gnome Meeting echo \"Gnome Meeting\" $IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 0000:30010 -j DNAT ‚Äîto-dest 1.1.1.2 $IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 1720 -j DNAT ‚Äîto-dest 1.1.1.2 $IPTABLES -A FORWARD -p tcp -i $EXTIF ‚Äîdport 30000:30010 -d 1.1.1.2 -j ACCEPT $IPTABLES -A FORWARD -p udp -i $EXTIF ‚Äîdport 5000:5003 -d 1.1.1.2 -j ACCEPT $IPTABLES -t nat -A PREROUTING -i $EXTIF -p UDP ‚Äîdport 5000:5003 -j DNAT ‚Äîto-dest 1.1.1.2 $IPTABLES -A FORWARD -p tcp -i $EXTIF ‚Äîdport 1720 -d 1.1.1.2 -j ACCEPT #Aim, MSN echo \"AIM, MSN\" $IPTABLES -t nat -A PREROUTING -i $EXTIF -p tcp ‚Äîdport 5190 -j REDIRECT ‚Äîto-ports 5190 $IPTABLES -t nat -A PREROUTING -i $EXTIF -p tcp ‚Äîdport 1863 -j REDIRECT ‚Äîto-ports 1863 $IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport 5190 -j ACCEPT $IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport 1863 -j ACCEPT $IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport 4443 -j ACCEPT $IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport 5566 -j ACCEPT $IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport 1864 -j ACCEPT #VNC Deneb :0 echo \"VNC\" $IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport 5800 -j ACCEPT $IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport 5900 -j ACCEPT $IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 5800 -j DNAT ‚Äîto 1.1.1.2:5800 $IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 5900 -j DNAT ‚Äîto 1.1.1.2:5900 $IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport 5500 -j ACCEPT $IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 5500 -j DNAT ‚Äîto 1.1.1.2:5500 #Firewall echo \"Firewall\" $IPTABLES -A INPUT -p TCP ‚Äîdport 3306 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 3306 -i $EXTIF2 -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 3128 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 53 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 25 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 25 -i $EXTIF2 -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 137 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 137 -i $EXTIF2 -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 139 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 139 -i $EXTIF2 -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 179 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 2600:2605 -i $EXTIF -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 179 -i $EXTIF2 -j DROP $IPTABLES -A INPUT -p TCP ‚Äîdport 2600:2605 -i $EXTIF2 -j DROP Si nos olvidamos hasta donde pone algo con IPTABLES, lo que tenemos es un script que habilita la funcionalidad de enrutado del kernel de linux, a partir de ese momento ya tendremos acceso ‚Äúte√≥rico‚Äù a internet‚Ä¶\nEl problema es que como s√≥lo tendremos una direcci√≥n IP v√°lida, lo que tendremos que hacer es hacer NAT (Network Address Translation), existen dos tipos de NAT, el de destino y el de origen, en nuestro caso es el de origen, es decir, al final, los datos que salgan tendr√°n que aparentar ser todos desde la misma IP‚Ä¶\nPara eso utilizamos esas sentencias de iptables que es el firewall, etc incorporado en Linux:\nLo de hacerlo con variables (las definidas al principio), es por facilidad a la hora de modificarlo, como ver√©is las redes est√°n definidas como IP/bits para hacer las conversiones acudid a: http://www.linux-es.com/ipcalc.php\nLas reglas definidas en este fichero, permiten que todo lo que salga por la eth0 (Internet) sea con NAT y que a su vez, lo que salga por eth3 (la wireless) sea tambi√©n con NAT (para tener acceso a la wireless desde la red local), luego permite el tr√°fico de paquetes entre las ip‚Äôs de las redes locales.\nEl script original fue modificado para cumplir con los requisitos de mi red, as√≠ que cada uno que lo adapte a la suya para que le sea √∫til.\nVale, un punto importante, es que al tener un trasto conectado todo el d√≠a a Internet, lo mejor es tenerlo bien asegurado, por eso, contar con una buena configuraci√≥n de firewall as√≠ como el portscanner vendr√° bien. Port scanner analiza y registra todos los intentos de escaneo de puertos contra nuestro equipo y posteriormente impide todo acceso desde las ip‚Äôs originantes, tanto creando rutas nulas como vuelta a esas ip‚Äôs como a√±adi√©ndola a los filtros de los TCP-wrappers En /etc/portsentry.ignore.static, pondremos:\n127.0.0.1/32 0.0.0.0 1.1.0.0/16 Para que no bloquee los locales (como indica en la ayuda) y a√±adimos los de nuestra red local‚Ä¶ equipos con IP 1.1.. (esto permite bloquear a los graciositos que se conecten por la wireless‚Ä¶)\nLuego, en el /etc/porsentry/portsentry.conf cambiaremos:\nBLOCK_UDP=\"1\" BLOCK_TCP=\"1\" y entre las otras opciones escogeremos las aptas para nuestro sistema, el tipo de bloqueo a realizar, etc\nAhora si alguien intenta hacer el tonto haciendo escaneos de puertos, pues autom√°ticamente le ser√° impedido posterior acceso desde esa Ip‚Ä¶\nPara arrancar el script del firewall crearemos un script con el formato est√°ndar tal como sigue:\n/etc/init.d/fire\n#!bash #!/bin/sh IPTABLES=/sbin/iptables # See how we were called. case \"$1\" in start) /etc/init.d/rc.firewall ;; stop) echo -e \"\\nFlushing firewall and setting default policies to DROP\\n\" $IPTABLES -P INPUT DROP $IPTABLES -F INPUT $IPTABLES -P OUTPUT DROP $IPTABLES -F OUTPUT $IPTABLES -P FORWARD DROP $IPTABLES -F FORWARD $IPTABLES -F -t nat # Delete all User-specified chains $IPTABLES -X # Reset all IPTABLES counters $IPTABLES -Z ;; restart) $0 stop $0 start ;; status) $IPTABLES -L ;; mlist) cat /proc/net/ip_conntrack ;; *) echo \"Usage: fire start|stop|status|mlist\" exit 1 ;; esac Si ahora creamos los enlaces simb√≥licos apropiados a este script en /etc/rc?.d pondremos especificar cuando queremos que se arranque el enrutamiento‚Ä¶\nEn mi caso:\nrc0.d/K20fire rc1.d/K20fire rc2.d/S20fire rc3.d/S20fire rc4.d/S20fire rc5.d/S20fire rc6.d/K20fire En esas carpetas dentro de /etc\nUn problema que tendremos al apagar el ordenador, es que como no tendremos monitor, no podremos saber cuando est√° listo para apagar y no vamos a conectar un monitor cada vez para hacerlo‚Ä¶\nT√∫neles\nAhora que parece que est√° m√°s o menos esto en marcha, habr√≠a que hacer t√∫neles entre los distintos nodos de otras personas, para eso os recomiendo el paquete VPND junto a los scripts de VPNS: VPN‚Äôs http://freshmeat.net/projects/vpns/\nHay un bonito README en el VPNS.\nConsejos Finales Vale, nuestro servidor tiene las tarjetas configuradas, enruta, hace de servidor DHCP, DNS, bloquea los escaneos de puertos‚Ä¶ ahora s√≥lo queda alg√∫n detalle interesante:\nLo primero: activar el soporte para el sistema de ficheros ext3, su compatibilidad con el ext2 es total, el cambio se hace simplemente poniendo:\ntune2fs -j /dev/hda1 (para la partici√≥n 1 del hd) y luego editando el /etc/fstab y donde ponga /dev/hda1 cambiar ext2 por ext3‚Ä¶\nDe ese modo, el sistema arrancar√° igual, pero con una ventaja‚Ä¶ en caso de apag√≥n, bloqueo, reseteo, etc, el sistema de ficheros ext3 crea un log de los cambios realizados y en esas situaciones, al siguiente rearranque, los puede corregir en la mayor√≠a de las situaciones el solito, provocando que si se va la luz, en cuanto vuelva, autom√°ticamente intente arrancar el solito (y en la mayor√≠a de los casos lo conseguir√° ;))\nOtras cosas √∫tiles‚Ä¶. configurar el SMB para poder acceder desde la red local con Windows‚Ä¶ as√≠ el servidor que hace de nodo, puede quedarse bajando cosas por la noche (si es nodo tiene que estar todo el d√≠a en marcha) y luego simplemente te las transfieres a tu equipo mediante el entorno de red‚Ä¶ (Existen hotwtos que lo explican muy bien as√≠ que‚Ä¶. a usar el Google que para eso est√°‚Ä¶)\nSer√≠a tambi√©n recomendable que instalases el DNS2GO que permite asignar un nombre de dominio a una IP din√°mica, de ese modo podr√≠as aprovechar para poner una p√°gina web en tu nodo con el apache e instalar el webalizer para analizar sus visitas, etc Como DNS2GO es ahora de pago, yo utilizo NO-IP. En Debian ten√©is un paquete llamado no-ip que incorpora un cliente listo para configurar y as√≠ actualizar autom√°ticamente vuestra ip din√°mica en el servidor DNS.\nPara configurar el zebra, lo √∫nico que tengo hecho por el momento es editar el /etc/zebra/daemons y activar zebra, ospfd y el bgpd‚Ä¶ cuando tenga tarjetas lo probar√© y dir√©‚Ä¶ (de esto se est√° encargando Hilario de ValenciaWireless\nPor el momento es todo‚Ä¶ con esto tienes un nodo‚Ä¶ puedes acceder por SSH a el para configurarlo remotamente (el putty es un buen cliente para Windows, WinSCP para transferencias seguras de archivos ;)), configurarlo por web (Webmin) y ya con eso para empezar est√° bien‚Ä¶\nRespecto a la VPN (pptpd)‚Ä¶ Pues antes no‚Ä¶ pero ahora ya va a la perfecci√≥n ;)\nSi no te conectas mediante VPN mediante la tarjeta de la wireless (eth3 en mi caso) no hay Internet (excepto por p√°gina web al puerto 80), y si te validas s√≠‚Ä¶ as√≠ que si tienes poco ancho de banda, puedes controlar si accedes o no desde fuera de tu red casera‚Ä¶ es decir.. gastas la red inal√°mbrica para acceder al de tu casita y una vez ah√≠ accedes a trav√©s de ese a Internet ;)\nSer√≠a interesante activar tambi√©n un Proxy tipo Squid para acelerar la navegaci√≥n por Internet‚Ä¶ tanto por la red local, como para los nodos (puedes restringir por ip‚Äôs, etc ) (yo lo tengo puesto adem√°s con el adzapper, que me permite eliminar much√≠simos anuncios de las webs por las que navego)\n¬°¬°Un saludo y suerte!!\nFicheros de configuraci√≥n Squid acl local src 1.1.0.0/16 http_access allow local maximum_object_size 32768 KB cache_dir ufs /var/spool/squid 512 16 256 httpd_accel_uses_host_header on redirect_program /usr/lib/squid/squid_redirect redirect_children 30 # PPTPD (para las VPN entrantes) /etc/ppp/pptpd-options debug name in chap-secrets name Merak auth +chap ms-dns 192.168.0.1 netmask 255.255.0.0 lock /etc/ppp/chap-secrets # Secrets for authentication using CHAP # client server secret IP addresses prueba * probando * Disfruta! (y si lo haces, puedes Invitarme a un caf√© ) ","wordCount":"6619","inLanguage":"es","image":"https://iranzo.io/mugshot.png","datePublished":"2003-06-18T21:39:00Z","dateModified":"2023-08-25T09:45:44.576Z","author":{"@type":"Person","name":"Pablo Iranzo G√≥mez"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://iranzo.io/es/blog/2003/06/18/montar-un-router-con-la-idea-de-wireless/"},"publisher":{"@type":"Organization","name":"Pablo Iranzo G√≥mez blog","logo":{"@type":"ImageObject","url":"https://iranzo.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://iranzo.io/es/ accesskey=h title="Home (Alt + H)"><img src=https://iranzo.io/apple-icon-152x152.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://iranzo.io/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://iranzo.io/es/ title=üè†Home><span>üè†Home</span></a></li><li><a href=https://iranzo.io/es/about/ title=üóíÔ∏èAbout><span>üóíÔ∏èAbout</span></a></li><li><a href=https://iranzo.io/es/redken_bot/ title=üêòredken_bot><span>üêòredken_bot</span></a></li><li><a href=https://iranzo.io/es/projects/ title=üìêProjects><span>üìêProjects</span></a></li><li><a href=https://iranzo.io/es/archives/ title="üóÑÔ∏è Archives"><span>üóÑÔ∏è Archives</span></a></li><li><a href=https://iranzo.io/es/categories/ title=üó∫Ô∏èCategories><span>üó∫Ô∏èCategories</span></a></li><li><a href=https://iranzo.io/es/tags/ title=üè∑Ô∏èTags><span>üè∑Ô∏èTags</span></a></li><li><a href=https://iranzo.io/es/search title="üîéSearch (Alt + /)" accesskey=/><span>üîéSearch</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://iranzo.io/es/>Inicio</a>&nbsp;¬ª&nbsp;<a href=https://iranzo.io/es/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">Montar un router con la idea de wireless</h1><div class=post-meta><span title='2003-06-18 21:39:00 +0000 UTC'>junio 18, 2003</span>&nbsp;¬∑&nbsp;32 min&nbsp;¬∑&nbsp;Pablo Iranzo G√≥mez</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Tabla de Contenidos</span></summary><div class=inner><ul><li><a href=#introducci%c3%b3n aria-label=Introducci√≥n>Introducci√≥n</a></li><li><a href=#sistema-operativo-y-paquetes aria-label="Sistema Operativo y Paquetes">Sistema Operativo y Paquetes</a></li><li><a href=#red aria-label=Red>Red</a></li><li><a href=#masquerading aria-label=Masquerading>Masquerading</a></li><li><a href=#consejos-finales aria-label="Consejos Finales">Consejos Finales</a></li><li><a href=#ficheros-de-configuraci%c3%b3n aria-label="Ficheros de configuraci√≥n">Ficheros de configuraci√≥n</a><ul><li><a href=#squid aria-label=Squid>Squid</a></li><li><a href=#etcppppptpd-options aria-label=/etc/ppp/pptpd-options>/etc/ppp/pptpd-options</a></li><li><a href=#etcpppchap-secrets aria-label=/etc/ppp/chap-secrets>/etc/ppp/chap-secrets</a></li></ul></li></ul></div></details></div><div class=post-content><h3 id=introducci√≥n>Introducci√≥n<a hidden class=anchor aria-hidden=true href=#introducci√≥n>#</a></h3><p>Un nodo nos permitir√° unir a personas conectadas desde sus tarjetas inal√°mbricas. Un nodo tiene que ser el punto de uni√≥n entre distintos clientes y a su vez enlazar con otros nodos para as√≠ crear una red.</p><p>En el caso de las redes inal√°mbricas, existen varias aproximaciones.</p><p>Un nodo puede ser un aparato denominado Punto de Acceso o por sus siglas en ingl√©s AP (Access Point) que contiene en su interior un interfaz wireless y una conexi√≥n Ethernet RJ45 para enlazarlo o bien con un equipo o con una red.</p><p>Un aparato que realice dichas funciones no es especialmente asequible adem√°s de que est√° bastante limitado&mldr;</p><p>La soluci√≥n m√°s aceptada es utilizar un PC para que haga de nodo, teniendo as√≠ much√≠sima m√°s flexibilidad a la hora de configurarlo (m√°s problem√°tico tambi√©n, no es &ldquo;enchufar y listo&rdquo; como con un AP de hardware).</p><p>Las tarjetas a la venta en el mercado tienen tres modos de operaci√≥n:</p><ol><li>Ad-hoc: Es el modo est√°ndar, en este tipo de modo de operaci√≥n, es el equivalente a las redes con Windows en las que se trabaja de igual a igual, todos son clientes y servidores.</li><li>Managed: un servidor independiente (un AP) es el lugar al que se conectan todas las dem√°s tarjetas inal√°mbricas, el AP gestiona todas las conexiones, enrutados, etc.</li><li>Master: Es el modo en el que trabaja el AP del punto anterior para que las tarjetas puedan trabajar como &ldquo;Managed&rdquo;.</li></ol><p>En redes con Windows s√≥lo es posible trabajar en los dos primeros modos, el Ad-Hoc y el Managed, para ello, como se ve, es necesario un AP por hardware que trabaje como Master al que las tarjetas que trabajan en Managed se puedan conectar. Y este es el punto en el que Linux marca la diferencia&mldr; con Linux, existe un controlador (hostap) para las tarjetas basadas en Prism2 (p.ej. las Conceptronic). Con Linux y con esos controladores, es posible poner en modo Master las tarjetas de red
(generalmente PCMCIA con un adaptador PCI para equipos de sobremesa) y de ese modo, hacer un AP por software.</p><p>Quisiera expresar mi agradecimiento a <code>Ghfjdksl</code> de #wireless, a Jorti de <code>#guadawireless</code> y a Hilario y a Hawkmoon de <code>#valenciawireless</code> por la ayuda prestada para montar este nodo. Saludos tambi√©n al resto de gente de <code>#valenciawireless</code> por sus largu√≠simas tertulias ;P</p><p>Hardware</p><p>Para la creaci√≥n del nodo, necesitaremos unos componentes de hardware tanto de software.</p><p>En la creaci√≥n del nodo de La Creu Wireless, el hardware es el siguiente:</p><ul><li>Placa AT Pentium 120</li><li>500 Mb HD</li><li>420 Mb HD (porque lo ten√≠a a mano, pero posiblemente lo quite&mldr; lo que menos quiero es que el ordenador haga m√°s ruido&mldr;)</li><li>64 mb Ram (iba a tener 16, pero a √∫ltima hora consegu√≠ m√°s&mldr;)</li><li>Tarjeta gr√°fica ATI Mach 64 Pro Turbo PCI</li><li>Ethernet ISA P&rsquo;n&rsquo;P Intel PRO 10/10+</li><li>Ethernet PCI basada en Realtek 8029 (10 mbps)</li><li>Ethernet PCI basada en Realtek 8139 (10/100)</li><li>Ethernet ISA P&rsquo;n&rsquo;P Compatible con NE 2000</li><li>Tarjeta wireless todav√≠a no la tengo, utilizo la ISA P&rsquo;n&rsquo;P compatible con NE2000 como si fuese la wireless (A la que en la actualidad tengo conectado un USR2450 en modo bridge con LinuxAP)</li><li>Tarjeta de sonido SB 16 P&rsquo;n&rsquo;P (no se para qu√© porque no la tengo conectada ni nada, pero el caso es que como la ten√≠a&mldr;.)</li><li>CD-ROM (instal√© desde disco duro porque no ten√≠a cd-rom en ese momento&mldr; pero bueno.. ahora s√≠ ;))</li><li>RJ45 (latiguillos), uno directo para conectar al m√≥dem y a la eth0 y luego tres cruzados para conectar a cada uno de los pc&rsquo;s sin necesidad de hub&mldr; si tienes hub, pues todos directos y listo&mldr;</li></ul><p>Se aceptan regalos ;) (Port√°tiles incluidos&mldr; ;) )</p><p>Volviendo a la realidad&mldr; memoria le sobra por un tubo, pero bueno, puestos a ponerle, pues se le pone m√°s :)</p><p>Disco duro me gustar√≠a ponerle m√°s, ya que como lo tengo que tener encendido todo el d√≠a para que sea un nodo &ldquo;fijo&rdquo;, pues aprovechar y dejar las largas descargas baj√°ndose en ese ordenador.</p><p>Lo de las tarjetas de red puede asustar al principio&mldr; pero bueno, tiene una clara explicaci√≥n&mldr; en casa tengo dos ordenadores y ahora con el nodo tres, la conexi√≥n a Internet requiere otra tarjeta de red y no me permite compartirla directamente conect√°ndola a un HUB, as√≠ que me parec√≠a algo tonto el tener que gastarme dinero en un HUB cuando las tarjetas de red ya las ten√≠a&mldr;</p><p>As√≠ que el montaje de la falla es el siguiente:</p><ul><li>Intel Pro ISA 10/10+: eth0 conectada a mi conexi√≥n a Internet</li><li>Realtek 8139 (10/100): eth1 conectada a mi equipo principal (tambi√©n con otra tarjeta 10/100, as√≠ que red local a 100 MBps ;) )</li><li>Realtek 8029: eth2 conectada al otro pc que tengo en casa (tambi√©n con una ethernet a 10 MBps)</li><li>Isa P&rsquo;n&rsquo;P NE2000: eth3 hace las labores de wireless hasta que tenga una de verdad (la utilizo para conectar otro equipo y hacer las pruebas como si estuviese conectado por wireless), en su momento ser√° utilizada para conexiones &ldquo;temporales&rdquo; por cable, siendo entonces eth4 la wireless &ldquo;real&rdquo;.</li></ul><p>Realmente con un HUB podr√≠a quitar dos tarjetas de red del ordenador (ya que el ordenador principal y el secundario ir√≠an conectados al hub y no ser√≠an necesarias las tarjetas correspondientes y s√≥lo utilizar√≠a la otra que quedase para Internet y la otra para conectar al HUB (si mi conexi√≥n me permitiese hacerlo, hasta podr√≠a conectar mi m√≥dem al HUB y ahorrarme otra tarjeta.. pero bueno, el caso es que no se puede&mldr;)</p><p>Como se puede ver, no digo nada de rat√≥n ni de monitor&mldr; el caso es que realmente no es necesario porque para hacer la instalaci√≥n inicial se har√° conect√°ndolo a otro monitor, pero una vez puesto en marcha no har√° falta para nada, de hecho hasta el teclado sobrar√≠a, pero como he dicho que es un P120 con AT, en los casos en los que tengo que apagar o reiniciar la m√°quina necesito algo que no implique un reset total (o sea, necesito tres teclas: CTRL-ALT-SUPR).</p><p>El teclado que tengo es uno de 84 teclas que ser√° como un teclado normal pero sin el bloque num√©rico y sin el bloque de av-pag, etc de tama√±o, tiene s√≥lo dos leds, Bloq may y bloq despl, pero lo dicho&mldr; sobra ;)</p><p>Ahora el ordenador es un P200 MMX con 128 Mb de RAM, las tarjetas son una Intel Pro ISA 10/10+, una SMC 100, 3Com 3c509 y NE2000, discos tiene uno de 10 Gb, y otro de 20, configurados como:</p><ul><li>128 Mb Swap</li><li>10 Mb boot</li><li>3 Gb sistema, usuarios</li><li>Resto = 26 Gb para descargas diversas&mldr; (pero con √°nimo educativo, no os vayais a pensar&mldr;)</li></ul><p>Ahora vamos a la configuraci√≥n del software&mldr;</p><h3 id=sistema-operativo-y-paquetes>Sistema Operativo y Paquetes<a hidden class=anchor aria-hidden=true href=#sistema-operativo-y-paquetes>#</a></h3><p>El primer paso previo a todos, es que una vez configurado el hardware para que no se queje (IRQ&rsquo;s, puertos IO, etc) (si la placa es realmente P&rsquo;n&rsquo;P no habr√° problemas pero la m√≠a aunque es P&rsquo;n&rsquo;P dio algunos problemas as√≠ que&mldr; ajo y agua&mldr;) Si has de comprar tarjetas y puedes, c√≥mpralas PCI y mejor todav√≠a si compras un HUB porque as√≠ no tienes que tener el ordenador rellenito en todas sus ranuras con ethernets ;).</p><p>Lo primero a configurar entonces es la BIOS.</p><p>Como cada BIOS es de un pap√° y de una mam√° distintos (aunque a veces la mam√° sea siempre Award o Ami), dar√© la explicaci√≥n general y que cada uno se las apa√±e con el manual de su placa base para hacer lo que digo&mldr;</p><p>PD: Si no sabes lo que es la BIOS, olv√≠date de seguir&mldr; esto no est√° hecho para t√≠&mldr; Mucho mejor que veas esto.</p><p>Configura las tarjetas en el orden que quieras, pero ten bien claro cu√°l ser√° cada una (si son todas iguales pues ser√° m√°s problem√°tico, pero no por ello imposible).</p><p>Primero pon el ordenador en fecha y hora, y en la opci√≥n que pone &ldquo;Halt on&rdquo; ponle que nada, es decir, que bajo ning√∫n concepto el ordenador no arranque (por ejemplo por falta de teclado, falta de monitor, etc porque al fin y al cabo luego no lo tendr√°&mldr;)</p><p>En la BIOS dile que de PNP su t√≠a&mldr; le dices que el sistema operativo no es P&rsquo;N&rsquo;P y que no se maree (puedes probar diciendo que s√≠, no deber√≠a ser muy tortuoso y si lo es, siempre lo puedes cambiar otra vez ;))</p><p>Como dispositivo de arranque se le pondr√° primero la disquetera, pero en el momento en que todo est√© configurado, se pondr√° fijo siempre el disco duro.</p><p>Si la placa es ATX, dile que tras un corte de luz, que se encienda sola&mldr; as√≠ evitar√°s los tiempos de apag√≥n del nodo al m√≠nimo.</p><p>Salva todos los cambios y reiniciar√° el ordenador&mldr; En mi caso, como no ten√≠a en un primer momento ni disquetera ni cd-rom, aprovech√© que el disco duro conten√≠a un Windows 95 y baj√© la imagen de CD-ROM de instalaci√≥n de Internet de Debian Potato, la convert√≠ del .ISO a carpetas y directorios normales y la guard√© por la red en el segundo HD del ordenador.</p><p>La imagen iso son unos 30 Mb y la descargu√© de la p√°gina de Debian. (<code>woody_netinst-20020626-i386.iso</code>)</p><p>La decisi√≥n de tomar &ldquo;Debian&rdquo; como sistema a instalar fue sencilla (lo de que ten√≠a que ser Linux estaba cantado por lo explicado en la introducci√≥n):</p><ul><li><strong>Red Hat Linux</strong>: Est√° muy bien, de hecho es con la que m√°s experiencia tengo, la tengo funcionando desde el a√±o 96 en un servidor y me va genial, poquitos problemas excepto actualizaciones, etc (aunque con las nuevas herramientas es muy f√°cil). Las actualizaciones, en el momento de lanzarlas, si hay muchos clientes de pago, pues a los que no pagamos, pues ajo y agua y a esperarse a que no est√© tan saturado&mldr; el formato de Red Hat, el RPM es el est√°ndar m√°s extendido. (Se puede bajar de internet en versi√≥n libre, llamada Fedora Core, o bien en cl√≥nicas basadas en RHEL).</li><li><strong>SuSE Linux</strong>: Est√° muy bien, si compras la distribuci√≥n, tienes muchos cd&rsquo;s con programas, manuales, etc Bastante bien adaptada al Espa√±ol (je, je), etc&mldr; Pero no se puede bajar la versi√≥n completa de internet porque tiene programas con licencias de distribuci√≥n que no lo permiten, s√≥lo si se compra. Utiliza el RPM que es un punto a favor, pero en contra es que no es compatible al 100% con las estructuras de directorios y funcionamientos de Red Hat, as√≠ que no hay forma de distinguir si ese RPM funcionar√° bien o no con SuSE. El peor inconveniente es la gran cantidad de recursos que necesita, tanto de RAM para la instalaci√≥n como para el almacenamiento en disco (la m√≠nima son unos 500 mb (pero m√≠nima m√≠nima m√≠nima&mldr;)). La ventaja es que la configuraci√≥n es toda en modo gr√°fico, con una autodetecci√≥n genial, etc. Ten√≠a experiencia con ella tanto de gastarla en casa como distribuci√≥n Linux, en la uni en un servidor como de haber colaborado en su traducci√≥n de manuales y de software de configuraci√≥n.</li><li><strong>Debian</strong>: No tenia ni puta idea de ella, una vez que la intent√© instalar casi me da algo con el programa de selecci√≥n de paquetes a instalar (dselect de la Potato). La instalaci√≥n es en modo texto. Tiene un sistema de actualizaci√≥n/instalaci√≥n bastante bueno en modo texto. la decisi√≥n fue usar Debian&mldr; de paso que aprend√≠a a gastarla, al ser en modo texto, ten√≠a el aliciente de que facilita su administraci√≥n remota (recordemos que el ordenador una vez instalado m√≠nimamente no iba a tener ni teclado ni rat√≥n ni monitor ni naa de na&mldr; excepto el cable de la luz y cuatro cables RJ45 para las tarjetas de red :))</li></ul><p>Vale, como ya he comentado, en el nodo, en el momento de su creaci√≥n no ten√≠a ni disquetera ni CD-ROM, as√≠ que se copiaron los archivos a una instalaci√≥n de Windows 95, se reinicia en modo-MS-DOS y una vez en el, se cambia al directorio donde se extrajo la imagen de cd y se ejecuta el programa de instalaci√≥n&mldr;</p><p>Si tienes grabadora y cd-rom en el nodo pues lo m√°s sencillo es bajar la iso, grabarla a un CD y arrancar desde el CD-ROM (en la bios se puede configurar esa opci√≥n).</p><p>Como ya he dicho, la imagen de instalaci√≥n es una NETINST, es decir, 30 mb m√≠nimos que se utilizan para una vez respondidas unas preguntas copiar un sistema b√°sico que se puede conectar a Internet y seguir bajando el resto de Internet&mldr; (Tengo una conexi√≥n a 128 kbps, as√≠ que que nadie me diga que es una locura porque es viable&mldr;)</p><p>Cuando yo hice la instalaci√≥n, la netinst m√°s habitual era la potato, pero hace nada que pasaron a Woody (3.0), el caso es que m√°s o menos son parecidas y de hecho una vez instal√© lo m√≠nimo hice el cambio a Woody usando el programa que lleva para hacerlo&mldr;</p><p>No voy a explicar la instalaci√≥n de Debian porque esto habla de configurar un nodo, no de instalar Linux, pero bueno, b√°sicamente consisti√≥ en particionar el HD, crear una partici√≥n swap de 40 Mb (ya dije que mi disco duro era peque√±ito..) y una de datos de 472 Mb como ext3 Es conveniente pensar un nombre para el nodo&mldr;la norma habitual, al menos en universidades, etc es ponerle nombres de estrellas o de cient√≠ficos, pero bueno&mldr; Cada uno que le ponga el que le de la gana&mldr;</p><p>Se configura el teclado, la tarjeta de red (como tengo Internet por tarjeta de cable fue tan sencillo como decirle que cargase los m√≥dulos de las tarjetas de red (en el caso de las ISA indicando tambi√©n la IO) y luego en la que estaba conectada a Internet, decirle que hiciese configuraci√≥n autom√°tica por DHCP y ya estaba la conexi√≥n funcionando&mldr;</p><p>En la selecci√≥n de paquetes puse lo m√≠nimo m√≠nimo, as√≠ que al ratito y tras un rearranque, me pidi√≥ asignar contrase√±as y crear un usuario (no es recomendable estar siempre como administrador para trabajar con Linux&mldr;)</p><p>Vale, llegados a este punto, tenemos ya el Linux instalado y tenemos delante la consola para iniciar sesi√≥n en el sistema. Vamos a necesitar varios programas adem√°s de los b√°sicos para trabajar con el nodo&mldr; si nos gusta Linux, pues nos gustar√° instalar alguno m√°s, pero bueno&mldr; por un lado est√°n los b√°sicos y los recomendados&mldr;</p><p>Como lo que estoy haciendo es explicar la configuraci√≥n de lo que yo hice con mi ordenador, pues all√° vamos:</p><p>Para la wireless hace falta el <code>wavemon</code> que es un monitor de estado de la tarjeta y el zebra para enrutar din√°micamente.</p><p>En mi caso, ya que ese ordenador iba a hacer de medio &ldquo;servidor&rdquo; en mi casa, pues me interes√≥ ponerle:</p><ul><li>samba: para compartir archivos e impresoras en un formato compatible con Windows y as√≠ poder luego bajar archivos de un ordenador a otro (del principal al nodo) mediante el entorno de red</li><li>pptpd: para permitir conexiones VPN, permite que desde internet (o en este caso, desde la wireless), se pueda conectar con el nodo, y se asigne otra direcci√≥n IP que permita hacer otras cosas que de normal no se podr√≠a&mldr; En mi caso, tengo limite de descarga en Internet y aunque por el momento no lo apliquen no quita que pudieran hacerlo&mldr; causa pues de que no comparta mi acceso a Internet a no ser que conozca directamente al equipo que se conecta&mldr; es decir, una vez conectado mediante la wireless, har√° una conexi√≥n VPN desde su Windows o su Linux al nodo y mediante un login y un pass tendr√° acceso a Internet a trav√©s del nodo, que de otra forma no tendr√≠a&mldr;) (un nodo no tiene que necesariamente tener acceso a Internet, pero es recomendable para unir los nodos y facilitar la integraci√≥n en la red, etc)</li><li>webmin: es un programa hecho por caldera y que funciona en multitud de plataformas y distribuciones, permite muy f√°cilmente configurar desde un navegador much√≠simas cosas del sistema. No digo que vaya a reemplazar a la configuraci√≥n en modo consola, pero para muchas cosas es much√≠simo m√°s f√°cil hacerlo desde navegador que tener que entrar, etc&mldr;</li><li>Otros paquetes instalados (muchos de ellos se instalan solitos como dependencias a los ya instalados&mldr;):</li></ul><p>A ver, en resumen, interesa instalar el ssh porque con el podremos entrar desde fuera al servidor, el webmin y los m√≥dulos listados arriba, etc</p><p>Lo dicho, esto es lo que yo tengo puesto&mldr; los paquetes se instalan poniendo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt-get install
</span></span></code></pre></div><p>por ejemplo: <code>apt-get install wavemon zebra webmin-stunnel webmin-status wget vtun</code></p><p>Autom√°ticamente el programa se conectar√° a Internet y comenzar√° a bajar esos paquetes y todos los necesarios para que esos funcionen, es decir, si instalas webmin-status, para eso te har√° falta primero el webmin y el programa lo instalar√° tambi√©n solito tras pedir confirmaci√≥n e indicar los megas a descargar y lo que ocupar√° una vez descomprimido.</p><h3 id=red>Red<a hidden class=anchor aria-hidden=true href=#red>#</a></h3><p>Vale, se supone que ahora ya tenemos el sistema funcionando y bueno&mldr; algo es algo :) ahora viene lo serio&mldr; configurarlo para que se adapte a nuestras necesidades&mldr;</p><p>Lo primero es tener un Kernel modernito (a mi con el est√°ndar no me iba, pero como ver√©is en la lista de paquetes con el 2.4 funciona bastante bien el P&rsquo;N&rsquo;P)</p><p>Tenemos que por un lado configurar las tarjetas de red: Para eso, entramos en <code>/etc/modutils</code> como root y tendremos varios archivos de configuraci√≥n, para ser representativo pondr√© el de una tarjeta ISA que son los m√°s dif√≠ciles:</p><p>Contenido de : <code>/etc/modutils/eepro</code></p><pre tabindex=0><code class=language-config data-lang=config>options eepro io=0x210
</code></pre><ul><li>Como ver√©is es altamente jodid√≠simo configurar una tarjeta de red&mldr; s√≥lo indicando el puerto de entrada salida Linux ya le busca la IRQ apropiada (en casos chungos, se le puede indicar tambi√©n)</li></ul><p>Con el resto de tarjetas editaremos los ficheros para ver que est√° todo bien y los llamaremos con el nombre del m√≥dulo necesario (sale durante la instalaci√≥n o en p√°ginas de ayuda) Luego, editaremos el fichero /etc/modules y pondremos las tarjetas en el orden en el que queremos que se llamen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># /etc/modules: kernel modules to load at boot time.
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span># This file should contain the names of kernel modules that are
</span></span><span style=display:flex><span># to be loaded at boot time, one per line. Comments begin with
</span></span><span style=display:flex><span># a &#34;#&#34;, and everything on the line after them are ignored.
</span></span><span style=display:flex><span>unix
</span></span><span style=display:flex><span>af_packet
</span></span><span style=display:flex><span>eepro
</span></span><span style=display:flex><span>tulip
</span></span><span style=display:flex><span>3c59x
</span></span><span style=display:flex><span>ne
</span></span><span style=display:flex><span>sb
</span></span></code></pre></div><p>Es decir, primero se cargar√° la EtherExpress Pro 10/10+ de Intel, que se llamar√° eth0 (tal como se explic√≥ en el apartado de hardware), luego la 8139 (10/100) como eth2, luego la ne2000 PCI (RTL 8029), luego la Novel 2000 ISA y por √∫ltimo la SoundBlaster&mldr;</p><p>En el caso de haber dos tarjetas con el mismo controlador, se ir√°n creando consecutivamente&mldr; es decir, si hay dos RTL8029, pues ser√°n eth1 y eth2 y as√≠ el resto&mldr; en mi caso como cada una es distinta no tuve ese &ldquo;problema&rdquo;.</p><p>Tras editar ese fichero, tendremos que hacer que al siguiente arranque se tome esta configuraci√≥n, as√≠ que ejecutaremos update-modules, para que el ordenador cree el /etc/modules.conf adecuado conforme a nuestros deseos., al siguiente arranque tendremos algo como:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Real Time Clock Driver v1.10e
</span></span><span style=display:flex><span>id: 0xb4 &lt;7&gt; io: 0x210 &lt;6&gt;eth0: Intel EtherExpress Pro/10+ ISA at 0x210,&lt;6&gt; 00&lt;6&gt;:aa&lt;6&gt;:00&lt;6&gt;:c9&lt;6&gt;:9d&lt;6&gt;:1a&lt;6&gt;, IRQ 11, 10BaseT.
</span></span><span style=display:flex><span>eepro.c: v0.13 11/08/2001 aris@cathedrallabs.org
</span></span><span style=display:flex><span>8139too Fast Ethernet driver 0.9.24
</span></span><span style=display:flex><span>eth1: RealTek RTL8139 Fast Ethernet at 0xc486b000, 00:50:fc:4d:c7:d9, IRQ 9
</span></span><span style=display:flex><span>eth1: Identified 8139 chip type ‚ÄôRTL-8139C‚Äô
</span></span><span style=display:flex><span>ne2k-pci.c:v1.02 10/19/2000 D. Becker/P. Gortmaker http://www.scyld.com/network/ne2k-pci.html
</span></span><span style=display:flex><span>eth2: RealTek RTL-8029 found at 0x6100, IRQ 9, 00:C0:DF:E3:46:F9.
</span></span><span style=display:flex><span>isapnp: Scanning for PnP cards...
</span></span><span style=display:flex><span>isapnp: Calling quirk for 01:00
</span></span><span style=display:flex><span>isapnp: SB audio device quirk - increasing port range
</span></span><span style=display:flex><span>isapnp: Card ‚ÄôCreative SB16 PnP‚Äô
</span></span><span style=display:flex><span>isapnp: 1 Plug &amp; Play card detected total
</span></span><span style=display:flex><span>ne.c:v1.10 9/23/94 Donald Becker (becker@scyld.com)
</span></span><span style=display:flex><span>Last modified Nov 1, 2000 by Paul Gortmaker
</span></span><span style=display:flex><span>NE*000 ethercard probe at 0x340: 00 40 33 94 ad 7d
</span></span><span style=display:flex><span>eth3: NE2000 found at 0x340, using IRQ 10.
</span></span><span style=display:flex><span>Soundblaster audio driver Copyright (C) by Hannu Savolainen 1993-1996
</span></span><span style=display:flex><span>sb: Creative SB16 PnP detected
</span></span><span style=display:flex><span>sb: ISAPnP reports ‚ÄôCreative SB16 PnP‚Äô at i/o 0x220, irq 5, dma 1, 5
</span></span><span style=display:flex><span>SB 4.13 detected OK (220)
</span></span><span style=display:flex><span>sb: 1 Soundblaster PnP card(s) found.
</span></span></code></pre></div><p>Como vemos, ya ha ido asignando tarjetas.. eth0 la Intel, eth1 la 8139, eth2 la 8029 y eth3 la Ne2000, lo de la SoundBlaster es accesorio, pero mola que la pille el solito ;) (con un kernel de la 2.4 aviso&mldr;)</p><p>Ahora falta configurar las direcciones para cada tarjeta&mldr; editamos el fichero /etc/network/interfaces:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># The first network card - this entry was created during the Debian installation
</span></span><span style=display:flex><span>auto eth0
</span></span><span style=display:flex><span>iface eth0 inet dhcp
</span></span><span style=display:flex><span>auto eth1
</span></span><span style=display:flex><span>iface eth1 inet static
</span></span><span style=display:flex><span>address 1.1.1.1
</span></span><span style=display:flex><span>netmask 255.255.255.0
</span></span><span style=display:flex><span>auto eth2
</span></span><span style=display:flex><span>iface eth2 inet static
</span></span><span style=display:flex><span>address 1.1.2.1
</span></span><span style=display:flex><span>netmask 255.255.255.0
</span></span><span style=display:flex><span>auto eth3
</span></span><span style=display:flex><span>iface eth3 inet static
</span></span><span style=display:flex><span>address 10.34.12.129
</span></span><span style=display:flex><span>netmask 255.255.255.224
</span></span><span style=display:flex><span>#auto eth3
</span></span><span style=display:flex><span>#iface eth3 inet static
</span></span><span style=display:flex><span># address 1.1.3.1
</span></span><span style=display:flex><span># netmask 255.255.255.0
</span></span></code></pre></div><p>Esto en cristiano viene a decir que cargue las tarjetas en el arranque (auto eth?), y lo de abajo, pues c√≥mo configurarlas&mldr; la eth0 es la que estaba conectada a internet, por lo tanto como mi proveedor configura por DHCP, pues eso pone&mldr; la eth1 es la de mi red local con el primero ordenador, le asigna una ip 1.1.1.1 y una m√°scara de subred de tipo C.</p><p>En realidad la direcci√≥n 1.1.1.1 est√° asignada en internet y ser√≠a una cabronada el conectarme con eso configurado as√≠, pero como hemos dicho, es una red local y no tiene porqu√© afectar a nadie, as√≠ que as√≠ se queda&mldr;</p><p>Con la segunda para la red local, pues lo mismo, pero con otra direcci√≥n 1.1.2.1 y con subred de tipo C y la ethernet 3 es lo que ser√≠a la wireless y le asigno una direcci√≥n real y v√°lida, en mi caso, esta ip pertenece a Valencia Wireless y est√° asignada a mi nodo, cada uno que consulte en <a href=http://www.redlibre.net/>http://www.redlibre.net</a> el direccionamiento y que se ponga encargado con el responsable de su zona si lo hay y si no, directamente con Redlibre&mldr;</p><p>Ahora, al arrancar el ordenador que hace de nodo, ya deber√≠a coger autom√°ticamente esos datos para cada tarjeta y funcionar as√≠ bien&mldr;</p><p>Me pod√©is preguntar que porqu√© asigno la 1.1.1.1 a una y la 1.1.2.1 a dos tarjetas que pertenecen a la misma red local&mldr; lo ideal ser√≠a 1.1.1.2, pero luego ten√≠a problemas con el DHCP (con un hub nunca hubiera pasado&mldr; pero como nadie me ha dado ninguno&mldr;) (luego se ver√° el motivo)</p><p>El siguiente paso, es que ya puestos, que el ordenador asigne direcciones a los ordenadores que se conecten de forma autom√°tica, es decir.. montar un servidor DHCP&mldr; para ello instalaremos el paquete DHCP y el servidor de nombres BIND, para que los equipos remotos que se conecten puedan pedir configuraci√≥n autom√°ticamente y que puedan
resolver nombres&mldr;</p><p>El fichero de configuraci√≥n del DHCP es el siguiente: (/etc/dhcp3/dhcp.conf):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>#
</span></span><span style=display:flex><span># Sample configuration file for ISC dhcpd
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span>ddns-updates on;
</span></span><span style=display:flex><span>use-host-decl-names on;
</span></span><span style=display:flex><span>allow unknown-clients;
</span></span><span style=display:flex><span>default-lease-time 3600;
</span></span><span style=display:flex><span>max-lease-time 7200;
</span></span><span style=display:flex><span>authoritative;
</span></span><span style=display:flex><span>subnet 10.34.12.128 netmask 255.255.255.224
</span></span><span style=display:flex><span>option domain-name-servers 10.34.12.129;
</span></span><span style=display:flex><span>range 10.34.12.131 10.34.12.158;
</span></span><span style=display:flex><span>option broadcast-address 10.34.12.159;
</span></span><span style=display:flex><span>option routers 10.34.12.129;
</span></span><span style=display:flex><span>subnet 192.168.1.0 netmask 255.255.255.0
</span></span><span style=display:flex><span>option domain-name-servers 192.168.1.1;
</span></span><span style=display:flex><span>range 192.168.1.2 192.168.1.254;
</span></span><span style=display:flex><span>option broadcast-address 192.168.1.255;
</span></span><span style=display:flex><span>option routers 192.168.1.1;
</span></span><span style=display:flex><span>subnet 1.1.1.0 netmask 255.255.255.0
</span></span><span style=display:flex><span>option domain-name-servers 1.1.1.1;
</span></span><span style=display:flex><span>option domain-name alufis;
</span></span><span style=display:flex><span>range 1.1.1.3 1.1.1.254;
</span></span><span style=display:flex><span>option broadcast-address 1.1.1.255;
</span></span><span style=display:flex><span>option routers 1.1.1.1;
</span></span><span style=display:flex><span>option netbios-name-servers 1.1.1.1;
</span></span><span style=display:flex><span>option netbios-node-type 8;
</span></span><span style=display:flex><span>subnet 1.1.2.0 netmask 255.255.255.0
</span></span><span style=display:flex><span>option domain-name alufis;
</span></span><span style=display:flex><span>option netbios-name-servers 1.1.2.1;
</span></span><span style=display:flex><span>option netbios-node-type 8;
</span></span><span style=display:flex><span>option domain-name-servers 1.1.2.1;
</span></span><span style=display:flex><span>range 1.1.2.3 1.1.2.254;
</span></span><span style=display:flex><span>option broadcast-address 1.1.2.255;
</span></span><span style=display:flex><span>option routers 1.1.2.1;
</span></span><span style=display:flex><span>subnet 1.1.3.0 netmask 255.255.255.0
</span></span><span style=display:flex><span>option domain-name-servers 1.1.3.1;
</span></span><span style=display:flex><span>option domain-name alufis;
</span></span><span style=display:flex><span>range 1.1.3.3 1.1.3.254;
</span></span><span style=display:flex><span>option broadcast-address 1.1.3.255;
</span></span><span style=display:flex><span>option routers 1.1.3.1;
</span></span><span style=display:flex><span>option netbios-name-servers 1.1.3.1;
</span></span><span style=display:flex><span>option netbios-node-type 8;
</span></span><span style=display:flex><span>host deneb
</span></span><span style=display:flex><span>option host-name &#34;deneb&#34;;
</span></span><span style=display:flex><span>hardware ethernet 00:04:e2:33:4e:8d;
</span></span><span style=display:flex><span>fixed-address 1.1.1.2;
</span></span><span style=display:flex><span>server-name &#34;deneb&#34;;
</span></span><span style=display:flex><span>host darkstar
</span></span><span style=display:flex><span>option host-name &#34;darkstar&#34;;
</span></span><span style=display:flex><span>hardware ethernet 00:80:c8:16:de:59;
</span></span><span style=display:flex><span>server-name &#34;darkstar&#34;;
</span></span><span style=display:flex><span>fixed-address 1.1.2.2;
</span></span><span style=display:flex><span>host Alnilam
</span></span><span style=display:flex><span>option host-name &#34;alnilam&#34;;
</span></span><span style=display:flex><span>hardware ethernet 00:90:d1:06:57:dc;
</span></span><span style=display:flex><span>fixed-address 10.34.12.130;
</span></span><span style=display:flex><span>server-name &#34;alnilam&#34;;
</span></span></code></pre></div><p>A ver&mldr; por partes&mldr;</p><p>Primero defino lo que ser√° la wireless, con la ip asignada, la subred, el rango de ip&rsquo;s, etc&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>subnet 10.34.12.128 netmask 255.255.255.224 option domain-name-servers 10.34.12.129; range 10.34.12.130 10.34.12.158; option broadcast-address 10.34.12.159; option routers 10.34.12.129;
</span></span></code></pre></div><p>Esto viene a significar que la red 10.34.12.128 (valencia wireless, mi nodo), con m√°scara de subred (255.255.255.224), tiene un servidor de nombres situado en 10.34.12.129 (la asignada a eth3), una direcci√≥n de broadcast en .158 y un router en .129 (el mismo que el DNS, es decir, el nodo&mldr;).</p><p>El rango de ip&rsquo;s asignado van desde la siguiente al nodo (.33) hasta el .62 de esa forma los clientes que pidan configuraci√≥n por DHCP por el interfaz con esa subred (eth3) obtendr√°n una IP dentro de ese rango&mldr;</p><p>192.168.<em>.</em> son direcciones para redes privadas y en este caso la utilizar√© para los equipos que se conecten mediante la VPN, es decir, equipos que primero se conectan por la wireless y luego se conectan mediante VPN, realmente no creo que fuese necesario indicarlo, pero lo prefiero as√≠ :)</p><p>Luego vienen definidas las redes para las tarjetas locales 1.1.1.1 y 1.1.2.1, si ambas tarjetas estuviesen en la misma red, con una sola definici√≥n bastar√≠a, pero el problema ser√≠a que si a la 1.1.1.3 que se conecta por la segunda tarjeta de red con IP 1.1.1.2 le digo que el router es 1.1.1.1 que es la primera tarjeta de red, pues habr√≠an problemas&mldr; no ir√≠a ni a tiros&mldr; esto con un HUB no pasa y no hace falta poner estas dos definiciones, pero en mi caso s√≠&mldr; as√≠ cada una es una red distinta
que va bien y asigna ip&rsquo;s autom√°ticamente y resuelve nombres.</p><p>Luego vienen dos declaraciones de equipo, en mi caso, a mis dos equipos de casa, les asigno ip&rsquo;s fijas, porque no me van a hacer falta m√°s (de hecho no har√≠a falta ni el dhcp para ellas, pero bueno, puestos a hacerlo a lo grande&mldr; pues ya lo tengo listo para un d√≠a meter dos hubs y poder conectar tropocientos ordenadores en cada tarjeta de red ;))</p><p>Para asignar IP fija, se hace en base a la direcci√≥n MAC de la tarjeta de red, que son esos c√≥digos en hexadecimal.</p><p>En el √∫ltimo caso defino otro ordenador pero sin ip fija (en su momento ir√° por la wireless y por eso no tiene nada puesto)</p><p>Respecto al servidor de nombres&mldr; no hice nada, s√≥lo instal√© el paquete y ya iba, as√≠ que no toqu√© nada :)</p><p>Hasta este punto los equipos cliente que se configuren para que pidan la configuraci√≥n autom√°ticamente, recibir√°n una configuraci√≥n v√°lida desde nuestro nodo, ahora s√≥lo falta hacer alguna cosilla m√°s ;)</p><h3 id=masquerading>Masquerading<a hidden class=anchor aria-hidden=true href=#masquerading>#</a></h3><p>Tenemos un servidor DHCP, las tarjetas configuradas y un servidor de nombres&mldr; ahora s√≥lo falta que enrute!!! de esa forma tendremos acceso a Internet desde cualquiera de nuestros ordenadores&mldr;</p><p>Para ello, si leemos el IP-MASQUERADING-HOWTO, sacaremos este interesante script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># rc.firewall-2.4</span>
</span></span><span style=display:flex><span>FWVER<span style=color:#f92672>=</span>0.63
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Initial SIMPLE IP Masquerade test for 2.4.x kernels using IPTABLES.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Once IP Masquerading has been tested, with this simple ruleset, it is highly recommended to use a stronger IPTABLES ruleset either given later in this HOWTO or from another reputable resource.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Log:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0.63 - Added support for the IRC IPTABLES module</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0.62 - Fixed a typo on the MASQ enable line that used eth0 instead of $EXTIF</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0.61 - Changed the firewall to use variables for the internal and external interfaces.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0.60 - 0.50 had a mistake where the ruleset had a rule to DROP all forwarded packets but it didn‚Äôt have a rule to ACCEPT any packets to be forwarded either - Load the ip_nat_ftp and ip_conntrack_ftp modules by default</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0.50 - Initial draft</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\n\nLoading simple rc.firewall version </span>$FWVER<span style=color:#e6db74>..\n&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The location of the ‚Äôiptables‚Äô program IPTABLES=/sbin/iptables</span>
</span></span><span style=display:flex><span>EXTIF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eth0&#34;</span>
</span></span><span style=display:flex><span>EXTIF2<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eth3&#34;</span>
</span></span><span style=display:flex><span>EXTIF3<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sl+&#34;</span>
</span></span><span style=display:flex><span>INTIF<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eth1&#34;</span>
</span></span><span style=display:flex><span>INTIF2<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eth2&#34;</span>
</span></span><span style=display:flex><span>INTIF3<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ppp+&#34;</span>
</span></span><span style=display:flex><span>LAN1<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.1.1.0/16&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; External Interface : </span>$EXTIF<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; External Interface 2 : </span>$EXTIF2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; External Interface 3 : </span>$EXTIF3<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; -----------------------------&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; Internal Interface : </span>$INTIF<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; Internal Interface 2 : </span>$INTIF2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; Internal Interface 3 : </span>$INTIF3<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; -----------------------------&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; Internal Network : </span>$LAN1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; enabling forwarding..&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;1&#34;</span> &gt; /proc/sys/net/ipv4/ip_forward
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; enabling DynamicAddr..&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;1&#34;</span> &gt; /proc/sys/net/ipv4/ip_dynaddr
</span></span><span style=display:flex><span><span style=color:#75715e># Borrar reglas anteriores tanto en normal como en nat y por defecto no enrutar</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -F
</span></span><span style=display:flex><span>$IPTABLES -F
</span></span><span style=display:flex><span>$IPTABLES -P FORWARD DROP
</span></span><span style=display:flex><span><span style=color:#75715e>#Conectar la red local para transferencia de datos</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -s $LAN1 -d $LAN1 -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e>#Pasar datos desde las locales a inet</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -s $LAN1 -o $EXTIF -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Aceptar paquetes de entrada a la local</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Enmascarar a internet</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A POSTROUTING -o $EXTIF -j MASQUERADE
</span></span><span style=display:flex><span><span style=color:#75715e>#Pasar datos desde las locales a la wireless</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -s $LAN1 -o $EXTIF2 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF2 -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Enmascarar a la wireless</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A POSTROUTING -s $LAN1 -o $EXTIF2 -j MASQUERADE
</span></span><span style=display:flex><span><span style=color:#75715e>#Entrada de la red local a los t√∫neles wireless (sl+)</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -s $LAN1 -o $EXTIF3 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF3 -d $LAN1 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Enmascarar a los t√∫neles</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A POSTROUTING -s $LAN1 -o $EXTIF3 -j MASQUERADE
</span></span><span style=display:flex><span><span style=color:#75715e>#Paquetes de entrada entre las wireless y los t√∫neles Wireless (sl+)</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF2 -o $EXTIF3 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF3 -o $EXTIF2 -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Paquetes de entrada de la VPN a internet y a la wireless</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $INTIF3 -o $EXTIF -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF -o $INTIF3 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $INTIF3 -o $EXTIF2 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF2 -o $INTIF3 -m state ‚Äîstate ESTABLISHED,RELATED -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e># Programas</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Proxy Transparente</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Transparent Proxy for SQUID&#34;</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport <span style=color:#ae81ff>80</span> -j REDIRECT ‚Äîto-port <span style=color:#ae81ff>3128</span> -d ! $LAN1
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport <span style=color:#ae81ff>25</span> -j REDIRECT ‚Äîto-port <span style=color:#ae81ff>25</span> -d ! $LAN1
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -p TCP ‚Äîdport <span style=color:#ae81ff>110</span> -j REDIRECT ‚Äîto-port <span style=color:#ae81ff>110</span> -d ! $LAN1
</span></span><span style=display:flex><span><span style=color:#75715e># Gnome Meeting</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Gnome Meeting&#34;</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport 0000:30010 -j DNAT ‚Äîto-dest 1.1.1.2
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>1720</span> -j DNAT ‚Äîto-dest 1.1.1.2
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -p tcp -i $EXTIF ‚Äîdport 30000:30010 -d 1.1.1.2 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -p udp -i $EXTIF ‚Äîdport 5000:5003 -d 1.1.1.2 -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p UDP ‚Äîdport 5000:5003 -j DNAT ‚Äîto-dest 1.1.1.2
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -p tcp -i $EXTIF ‚Äîdport <span style=color:#ae81ff>1720</span> -d 1.1.1.2 -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e>#Aim, MSN</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;AIM, MSN&#34;</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>5190</span> -j REDIRECT ‚Äîto-ports <span style=color:#ae81ff>5190</span>
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>1863</span> -j REDIRECT ‚Äîto-ports <span style=color:#ae81ff>1863</span>
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>5190</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>1863</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>4443</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>5566</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -i $EXTIF -p tcp ‚Äîdport <span style=color:#ae81ff>1864</span> -j ACCEPT
</span></span><span style=display:flex><span><span style=color:#75715e>#VNC Deneb :0</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;VNC&#34;</span>
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5800</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5900</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5800</span> -j DNAT ‚Äîto 1.1.1.2:5800
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5900</span> -j DNAT ‚Äîto 1.1.1.2:5900
</span></span><span style=display:flex><span>$IPTABLES -A FORWARD -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5500</span> -j ACCEPT
</span></span><span style=display:flex><span>$IPTABLES -t nat -A PREROUTING -i $EXTIF -p TCP ‚Äîdport <span style=color:#ae81ff>5500</span> -j DNAT ‚Äîto 1.1.1.2:5500
</span></span><span style=display:flex><span><span style=color:#75715e>#Firewall</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Firewall&#34;</span>
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>3306</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>3306</span> -i $EXTIF2 -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>3128</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>53</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>25</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>25</span> -i $EXTIF2 -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>137</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>137</span> -i $EXTIF2 -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>139</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>139</span> -i $EXTIF2 -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>179</span> -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport 2600:2605 -i $EXTIF -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport <span style=color:#ae81ff>179</span> -i $EXTIF2 -j DROP
</span></span><span style=display:flex><span>$IPTABLES -A INPUT -p TCP ‚Äîdport 2600:2605 -i $EXTIF2 -j DROP
</span></span></code></pre></div><p>Si nos olvidamos hasta donde pone algo con IPTABLES, lo que tenemos es un script que habilita la funcionalidad de enrutado del kernel de linux, a partir de ese momento ya tendremos acceso &ldquo;te√≥rico&rdquo; a internet&mldr;</p><p>El problema es que como s√≥lo tendremos una direcci√≥n IP v√°lida, lo que tendremos que hacer es hacer NAT (Network Address Translation), existen dos tipos de NAT, el de destino y el de origen, en nuestro caso es el de origen, es decir, al final, los datos que salgan tendr√°n que aparentar ser todos desde la misma IP&mldr;</p><p>Para eso utilizamos esas sentencias de iptables que es el firewall, etc incorporado en Linux:</p><p>Lo de hacerlo con variables (las definidas al principio), es por facilidad a la hora de modificarlo, como ver√©is las redes est√°n definidas como IP/bits para hacer las conversiones acudid a: <a href=http://www.linux-es.com/ipcalc.php>http://www.linux-es.com/ipcalc.php</a></p><p>Las reglas definidas en este fichero, permiten que todo lo que salga por la eth0 (Internet) sea con NAT y que a su vez, lo que salga por eth3 (la wireless) sea tambi√©n con NAT (para tener acceso a la wireless desde la red local), luego permite el tr√°fico de paquetes entre las ip&rsquo;s de las redes locales.</p><p>El script original fue modificado para cumplir con los requisitos de mi red, as√≠ que cada uno que lo adapte a la suya para que le sea √∫til.</p><p>Vale, un punto importante, es que al tener un trasto conectado todo el d√≠a a Internet, lo mejor es tenerlo bien asegurado, por eso, contar con una buena configuraci√≥n de firewall as√≠ como el portscanner vendr√° bien. Port scanner analiza y registra todos los intentos de escaneo de puertos contra nuestro equipo y posteriormente impide todo acceso desde las ip&rsquo;s originantes, tanto creando rutas nulas como vuelta a esas ip&rsquo;s como a√±adi√©ndola a los filtros de los TCP-wrappers En
/etc/portsentry.ignore.static, pondremos:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>127.0.0.1/32 0.0.0.0 1.1.0.0/16
</span></span></code></pre></div><p>Para que no bloquee los locales (como indica en la ayuda) y a√±adimos los de nuestra red local&mldr; equipos con IP 1.1.<em>.</em> (esto permite bloquear a los graciositos que se conecten por la wireless&mldr;)</p><p>Luego, en el /etc/porsentry/portsentry.conf cambiaremos:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>BLOCK_UDP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>BLOCK_TCP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span></code></pre></div><p>y entre las otras opciones escogeremos las aptas para nuestro sistema, el tipo de bloqueo a realizar, etc</p><p>Ahora si alguien intenta hacer el tonto haciendo escaneos de puertos, pues autom√°ticamente le ser√° impedido posterior acceso desde esa Ip&mldr;</p><p>Para arrancar el script del firewall crearemos un script con el formato est√°ndar tal como sigue:</p><p>/etc/init.d/fire</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>IPTABLES<span style=color:#f92672>=</span>/sbin/iptables
</span></span><span style=display:flex><span><span style=color:#75715e># See how we were called.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>    start<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        /etc/init.d/rc.firewall
</span></span><span style=display:flex><span>       ;;
</span></span><span style=display:flex><span>    stop<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\nFlushing firewall and setting default policies to DROP\n&#34;</span>
</span></span><span style=display:flex><span>        $IPTABLES -P INPUT DROP
</span></span><span style=display:flex><span>        $IPTABLES -F INPUT
</span></span><span style=display:flex><span>        $IPTABLES -P OUTPUT DROP
</span></span><span style=display:flex><span>        $IPTABLES -F OUTPUT
</span></span><span style=display:flex><span>        $IPTABLES -P FORWARD DROP
</span></span><span style=display:flex><span>        $IPTABLES -F FORWARD
</span></span><span style=display:flex><span>        $IPTABLES -F -t nat
</span></span><span style=display:flex><span>        <span style=color:#75715e># Delete all User-specified chains</span>
</span></span><span style=display:flex><span>        $IPTABLES -X
</span></span><span style=display:flex><span>        <span style=color:#75715e># Reset all IPTABLES counters</span>
</span></span><span style=display:flex><span>        $IPTABLES -Z
</span></span><span style=display:flex><span>        ;;
</span></span><span style=display:flex><span>    restart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        $0 stop
</span></span><span style=display:flex><span>        $0 start
</span></span><span style=display:flex><span>        ;;
</span></span><span style=display:flex><span>    status<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        $IPTABLES -L
</span></span><span style=display:flex><span>        ;;
</span></span><span style=display:flex><span>    mlist<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        cat /proc/net/ip_conntrack
</span></span><span style=display:flex><span>        ;;
</span></span><span style=display:flex><span>    *<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Usage: fire start|stop|status|mlist&#34;</span>
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        ;;
</span></span><span style=display:flex><span><span style=color:#66d9ef>esac</span>
</span></span></code></pre></div><p>Si ahora creamos los enlaces simb√≥licos apropiados a este script en <code>/etc/rc?.d</code> pondremos especificar cuando queremos que se arranque el
enrutamiento&mldr;</p><p>En mi caso:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rc0.d/K20fire
</span></span><span style=display:flex><span>rc1.d/K20fire
</span></span><span style=display:flex><span>rc2.d/S20fire
</span></span><span style=display:flex><span>rc3.d/S20fire
</span></span><span style=display:flex><span>rc4.d/S20fire
</span></span><span style=display:flex><span>rc5.d/S20fire
</span></span><span style=display:flex><span>rc6.d/K20fire
</span></span></code></pre></div><p>En esas carpetas dentro de /etc</p><p>Un problema que tendremos al apagar el ordenador, es que como no tendremos monitor, no podremos saber cuando est√° listo para apagar y no vamos a conectar un monitor cada vez para hacerlo&mldr;</p><p>T√∫neles</p><p>Ahora que parece que est√° m√°s o menos esto en marcha, habr√≠a que hacer t√∫neles entre los distintos nodos de otras personas, para eso os recomiendo el paquete VPND junto a los scripts de VPNS: VPN&rsquo;s <a href=http://freshmeat.net/projects/vpns/>http://freshmeat.net/projects/vpns/</a></p><p>Hay un bonito README en el VPNS.</p><h3 id=consejos-finales>Consejos Finales<a hidden class=anchor aria-hidden=true href=#consejos-finales>#</a></h3><p>Vale, nuestro servidor tiene las tarjetas configuradas, enruta, hace de servidor DHCP, DNS, bloquea los escaneos de puertos&mldr; ahora s√≥lo queda alg√∫n detalle interesante:</p><p>Lo primero: activar el soporte para el sistema de ficheros ext3, su compatibilidad con el ext2 es total, el cambio se hace simplemente poniendo:</p><p><code>tune2fs -j /dev/hda1</code> (para la partici√≥n 1 del hd) y luego editando el /etc/fstab y donde ponga /dev/hda1 cambiar ext2 por ext3&mldr;</p><p>De ese modo, el sistema arrancar√° igual, pero con una ventaja&mldr; en caso de apag√≥n, bloqueo, reseteo, etc, el sistema de ficheros ext3 crea un log de los cambios realizados y en esas situaciones, al siguiente rearranque, los puede corregir en la mayor√≠a de las situaciones el solito, provocando que si se va la luz, en cuanto vuelva, autom√°ticamente intente arrancar el solito (y en la mayor√≠a de los casos lo conseguir√° ;))</p><p>Otras cosas √∫tiles&mldr;. configurar el SMB para poder acceder desde la red local con Windows&mldr; as√≠ el servidor que hace de nodo, puede quedarse bajando cosas por la noche (si es nodo tiene que estar todo el d√≠a en marcha) y luego simplemente te las transfieres a tu equipo mediante el entorno de red&mldr; (Existen hotwtos que lo explican muy bien as√≠ que&mldr;. a usar el Google que para eso est√°&mldr;)</p><p>Ser√≠a tambi√©n recomendable que instalases el DNS2GO que permite asignar un nombre de dominio a una IP din√°mica, de ese modo podr√≠as aprovechar para poner una p√°gina web en tu nodo con el apache e instalar el webalizer para analizar sus visitas, etc Como DNS2GO es ahora de pago, yo utilizo NO-IP. En Debian ten√©is un paquete llamado no-ip que incorpora un cliente listo para configurar y as√≠ actualizar autom√°ticamente vuestra ip din√°mica en el servidor DNS.</p><p>Para configurar el zebra, lo √∫nico que tengo hecho por el momento es editar el /etc/zebra/daemons y activar zebra, ospfd y el bgpd&mldr; cuando tenga tarjetas lo probar√© y dir√©&mldr; (de esto se est√° encargando Hilario de ValenciaWireless</p><p>Por el momento es todo&mldr; con esto tienes un nodo&mldr; puedes acceder por SSH a el para configurarlo remotamente (el putty es un buen cliente para Windows, WinSCP para transferencias seguras de archivos ;)), configurarlo por web (Webmin) y ya con eso para empezar est√° bien&mldr;</p><p>Respecto a la VPN (pptpd)&mldr; Pues antes no&mldr; pero ahora ya va a la perfecci√≥n ;)</p><p>Si no te conectas mediante VPN mediante la tarjeta de la wireless (eth3 en mi caso) no hay Internet (excepto por p√°gina web al puerto 80), y si te validas s√≠&mldr; as√≠ que si tienes poco ancho de banda, puedes controlar si accedes o no desde fuera de tu red casera&mldr; es decir.. gastas la red inal√°mbrica para acceder al de tu casita y una vez ah√≠ accedes a trav√©s de ese a Internet ;)</p><p>Ser√≠a interesante activar tambi√©n un Proxy tipo Squid para acelerar la navegaci√≥n por Internet&mldr; tanto por la red local, como para los nodos (puedes restringir por ip&rsquo;s, etc ) (yo lo tengo puesto adem√°s con el adzapper, que me permite eliminar much√≠simos anuncios de las webs por las que navego)</p><p>¬°¬°Un saludo y suerte!!</p><h3 id=ficheros-de-configuraci√≥n>Ficheros de configuraci√≥n<a hidden class=anchor aria-hidden=true href=#ficheros-de-configuraci√≥n>#</a></h3><h4 id=squid>Squid<a hidden class=anchor aria-hidden=true href=#squid>#</a></h4><pre tabindex=0><code class=language-config data-lang=config>acl local src 1.1.0.0/16
http_access allow local
maximum_object_size 32768 KB
cache_dir ufs /var/spool/squid 512 16 256
httpd_accel_uses_host_header on
redirect_program /usr/lib/squid/squid_redirect
redirect_children 30 # PPTPD (para las VPN entrantes)
</code></pre><h4 id=etcppppptpd-options>/etc/ppp/pptpd-options<a hidden class=anchor aria-hidden=true href=#etcppppptpd-options>#</a></h4><pre tabindex=0><code class=language-config data-lang=config>debug
name in chap-secrets
name Merak
auth
+chap
ms-dns 192.168.0.1
netmask 255.255.0.0
lock
</code></pre><h4 id=etcpppchap-secrets>/etc/ppp/chap-secrets<a hidden class=anchor aria-hidden=true href=#etcpppchap-secrets>#</a></h4><pre tabindex=0><code class=language-config data-lang=config># Secrets for authentication using CHAP
# client server secret IP addresses
prueba * probando *
</code></pre><p>Disfruta! (y si lo haces, puedes
<a href=https://ko-fi.com/I2I4KDA0V target=_blank><img src=https://storage.ko-fi.com/cdn/brandasset/kofi_s_logo_nolabel.png height=36 style=border:0;height:36px;vertical-align:middle;display:inline-block border=0>
</img>
Invitarme a un caf√©
</a>)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://iranzo.io/es/tags/linux/>Linux</a></li><li><a href=https://iranzo.io/es/tags/wireless/>Wireless</a></li><li><a href=https://iranzo.io/es/tags/router/>Router</a></li><li><a href=https://iranzo.io/es/tags/firewall/>Firewall</a></li><li><a href=https://iranzo.io/es/tags/foss/>Foss</a></li></ul><nav class=paginav><a class=prev href=https://iranzo.io/es/blog/2004/02/06/configurar-exim3-con-mailscanner-y-clamav/><span class=title>¬´ Anterior</span><br><span>Configurar Exim3 con MailScanner y ClamAV</span>
</a><a class=next href=https://iranzo.io/es/blog/2003/06/03/bookcrossing-libera-tus-libros/><span class=title>Siguiente ¬ª</span><br><span>Bookcrossing - Libera tus libros</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on x" href="https://x.com/intent/tweet/?text=Montar%20un%20router%20con%20la%20idea%20de%20wireless&amp;url=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f&amp;hashtags=linux%2cwireless%2crouter%2cfirewall%2cfoss"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f&amp;title=Montar%20un%20router%20con%20la%20idea%20de%20wireless&amp;summary=Montar%20un%20router%20con%20la%20idea%20de%20wireless&amp;source=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on reddit" href="https://reddit.com/submit?url=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f&title=Montar%20un%20router%20con%20la%20idea%20de%20wireless"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on whatsapp" href="https://api.whatsapp.com/send?text=Montar%20un%20router%20con%20la%20idea%20de%20wireless%20-%20https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on telegram" href="https://telegram.me/share/url?text=Montar%20un%20router%20con%20la%20idea%20de%20wireless&amp;url=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Montar un router con la idea de wireless on ycombinator" href="https://news.ycombinator.com/submitlink?t=Montar%20un%20router%20con%20la%20idea%20de%20wireless&u=https%3a%2f%2firanzo.io%2fes%2fblog%2f2003%2f06%2f18%2fmontar-un-router-con-la-idea-de-wireless%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://iranzo.io/es/>Pablo Iranzo G√≥mez blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><center><small>This blog is a participant in the Amazon Associate Program, an affiliate advertising program designed to provide a means for sites to earn advertising fees by advertising and linking to Amazon.</small></center><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copiar";function s(){t.innerHTML="¬°copiado!",setTimeout(()=>{t.innerHTML="copiar"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>