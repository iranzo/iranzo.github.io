<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Redken machine learning for spam detection | Pablo Iranzo Gómez blog</title>
<meta name=keywords content="FOSS,Telegram,Python,programming,redken,scikit,machine learning,ML"><meta name=description content="For some of the telegram groups I&rsquo;m in, I&rsquo;ve been detecting users that after some period of time, just publish spam messages of any topic.
There are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).
Some time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement."><meta name=author content="Pablo Iranzo Gómez"><link rel=canonical href=https://iranzo.io/blog/2021/06/24/redken-machine-learning-for-spam-detection/><meta name=google-site-verification content="Bk4Z5ucHLyPXqlZlj5LzANpYBBSvxqBW4E8i-Kwf-bQ"><meta name=yandex-verification content="993ede96cdfbee95"><link crossorigin=anonymous href=../../../../../assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://iranzo.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://iranzo.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://iranzo.io/favicon-32x32.png><link rel=apple-touch-icon href=https://iranzo.io/apple-touch-icon.png><link rel=mask-icon href=https://iranzo.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://iranzo.io/blog/2021/06/24/redken-machine-learning-for-spam-detection/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZL9P943TP1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZL9P943TP1")}</script><meta property="og:url" content="https://iranzo.io/blog/2021/06/24/redken-machine-learning-for-spam-detection/"><meta property="og:site_name" content="Pablo Iranzo Gómez blog"><meta property="og:title" content="Redken machine learning for spam detection"><meta property="og:description" content="For some of the telegram groups I’m in, I’ve been detecting users that after some period of time, just publish spam messages of any topic.
There are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).
Some time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-06-24T22:00:00+02:00"><meta property="article:modified_time" content="2023-08-25T09:46:05+00:00"><meta property="article:tag" content="FOSS"><meta property="article:tag" content="Telegram"><meta property="article:tag" content="Python"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Redken"><meta property="article:tag" content="Scikit"><meta property="og:image" content="https://iranzo.io/mugshot.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://iranzo.io/mugshot.png"><meta name=twitter:title content="Redken machine learning for spam detection"><meta name=twitter:description content="For some of the telegram groups I&rsquo;m in, I&rsquo;ve been detecting users that after some period of time, just publish spam messages of any topic.
There are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).
Some time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://iranzo.io/blog/"},{"@type":"ListItem","position":2,"name":"Redken machine learning for spam detection","item":"https://iranzo.io/blog/2021/06/24/redken-machine-learning-for-spam-detection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Redken machine learning for spam detection","name":"Redken machine learning for spam detection","description":"For some of the telegram groups I\u0026rsquo;m in, I\u0026rsquo;ve been detecting users that after some period of time, just publish spam messages of any topic.\nThere are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).\nSome time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement.\n","keywords":["FOSS","Telegram","Python","programming","redken","scikit","machine learning","ML"],"articleBody":"For some of the telegram groups I’m in, I’ve been detecting users that after some period of time, just publish spam messages of any topic.\nThere are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).\nSome time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement.\nFirst thing I wanted, was to get rid of the spammers, so the first approach was to include a new command on redken_bot to mark with /spam when replying to a message to take some actions.\nThe /spam command also required some protection from abuse, so it should only work for admins.\nThe admin detection In the beginning some of the commands added to redken_bot had admin access that required the user to define the list of administrators via the admin configuration variable… but no one did.\nWith some changes in the telegram BOT API, the bot can get (when added as one of the admins in your group) the membership permission updates, so when a membership update arrives (new user added as admin or admin user becoming regular user), the bot will call the function to refresh the list of administrators and use it to update the admin variable automatically.\nThis required changing the way calls were made to get new telegram updates, but I enabled all the possible types of messages, as well as rewriting the function processing the data out of each message, but was a good improvement (even if invisible for outside users.)\nSpam actions Once the admin detection was solved and running (bot currently is member of 549 groups and has 28252 unique users, and only 20 groups have the admin variable set), the next step was to work on the spam actions.\nMany times I was manually doing the stuff:\nDeleting message Kicking user and reporting as spam Sometimes even noting user UID to add to a blocklist So I decided to create a new command /spam which automates part of the job:\nDeletes message Stores UID in the database as spammer Kicks user out of the chat Buttons for easier usage It would be great to have automatic detection, and easier reporting, so next step was playing a bit with buttons.\nTo be honest, never used them except for some attempts, but as I was playing with updated messages for the admin stuff, so was worth to use the feature that was there to add extra parameters to the call.\nyes = \"Yes\" no = \"No\" ignore = \"Ignore\" isthisspammsg = \"Is this spam?\" extra = ( 'reply_markup={\"inline_keyboard\":[[{\"text\":\"%s\",\"callback_data\":\"SPAM\"},{\"text\":\"%s\",\"callback_data\":\"HAM\"},{\"text\":\"%s\",\"callback_data\":\"IGNORE\"}]]}' % (yes, no, ignore) ) With above approach, the bot could reply to messages and attach an inline-keyboard with configurable buttons, returning as part of the callback data the message I wanted (HAM,SPAM or IGNORE).\nThis, also required to process the callback_data that we were now collecting since the changes added for the admin status change.\nThe good thing is that the answer provided when pressing the button, contains reference to the original message, so it was easier to later catch the text we were replying with the buttons.\nMachine learning Machine learning more or less, is showing data to an algorithm with results tagged in one or either way, divide the set of data between a training group and a test group and feed it to the algorithm to find how good it has been.\nFor doing so, it converts the input data into numbers and tries to find relationships between them. This also opens the pandora box as it has lot of different approaches, depending on the function being used for doing the conversion, for example, some of them use frequency of elements, removing the less frequent, etc\nFinally, using the model the program can classify new data, based on the model that was elaborated, and in order to improve it, the data should be refreshed with new patterns for both cases: ham and spam so that it can continue evolving.\nThere are lot of documents about this, the shortest example I can think of is:\nfrom langdetect import detect from nltk.corpus import stopwords from sklearn.feature_extraction.text import CountVectorizer from sklearn.feature_extraction.text import TfidfTransformer from sklearn.metrics import classification_report, confusion_matrix, accuracy_score from sklearn.model_selection import train_test_split from sklearn.naive_bayes import MultinomialNB from sklearn.pipeline import Pipeline import logging import nltk import os import pandas as pd import pickle import dill import string import sys logger = logging.getLogger(__name__) logger.debug(\"Downloading updated stopwords\") nltk.download(\"stopwords\") logger.debug(\"Starting training with on-disk databases\") message = pd.read_csv( \"spam/spam.%s.csv\" % language, sep=\",\", names=[\"Category\", \"Message\"] ) # Drop duplicate messages message.drop_duplicates(inplace=True) # Split the messages between train and test msg_train, msg_test, label_train, label_test = train_test_split( message[\"Message\"], message[\"Category\"], test_size=0.2 ) # Define the function for our language pipeline = Pipeline( [ ( \"bow\", CountVectorizer( analyzer=lambda text: process_text(text, language=languages[language]) ), ), (\"tfidf\", TfidfTransformer()), (\"classifier\", MultinomialNB()), ] ) logger.debug(\"Training the algorithm for language: %s\" % language) pipeline.fit(msg_train, label_train) # Evaluate the model on the training data set print(\"Testing the training for language: %s\" % language) pred = pipeline.predict(msg_train) logger.debug(\"Accuracy with train data\") logger.debug(\"%s\" % classification_report(label_train, pred)) logger.debug(\"Confusion Matrix:\\n%s\" % confusion_matrix(label_train, pred)) logger.debug(\"Accuracy: %s\" % accuracy_score(label_train, pred)) pred = pipeline.predict(msg_test) logger.debug(\"Accuracy with test data\") logger.debug(\"%s\" % classification_report(label_test, pred)) logger.debug(\"Confusion Matrix:\\n%s\" % confusion_matrix(label_test, pred)) accuracy = accuracy_score(label_test, pred) logger.debug(\"Accuracy: %s\" % accuracy) In short, this loads a know list of messages with spam and ham and divides it to train the model (via the pipeline) and later to test on the test data to check accuracy.\nFor doing so, it also downloads stopwords, which allows to remove junctions from phrases that are usually less meaningful of the message data itself. The process_text function defined in the pipeline is the one that we should write and takes care of removing punctuation, stopwords, etc.\nOf course, training takes a while so it’s not something you’ll be doing in realtime, but there is where the dill library (that worked better for my use case than pickle) helped me… Bot trains every day for new language model, stores it on disk, and later is able to restore from disk and directly use it.\nFor saving and restoring we can use something like this:\n# Save trained pipeline with open(pkl_filename, \"wb\") as file: dill.dump(pipeline, file) # Restore trained pipeline with open(pkl_filename, \"rb\") as file: pipeline = dill.load(file) So, here we’ve already all the pieces…\nWe can train a pipeline with our database of spam We can save and restore a pipeline so that we can do the hard work in easy moments and still have fast results when using it We can report messages as spam manually and perform actions The last piece of glue, was extending the /spam command to also store the message received and marked as spam into the database.\nWith this approach, the bot is able to work on the current existing database to generate a model, and still allow to grow the database with admin-reported spam messages. Those messages will then be used to train the pipeline periodically either as training or test, helping improving and enhancing the detection\nSo the actual behavior is that @redken_bot does:\nChecks new message if a model for that language exists (only saves it when accuracy is 85% or higher) If it’s spam, It will show a keyboard to either mark as spam (confirm) or ignore the message Admins can reply with /spam to messages, even if there’s no model for that language, helping in creating the database of messages If a message has been marked as spam, either by replying with /spam or by clicking on the button saying that it’s spam, the spam process begins: The button is always removed when replying (with the question about spam status) If the message was marked as spam, the original message is removed The user that sent the message, gets added to the database as spammer and then kicked out of the chat The message is stored on the database for future enhancement of the machine language detection. Additionally, I’m testing a ‘ham’ training feature, being fed with regular messages to start building a positive set of messages to compare with.\nI will continue searching for spam databases in other languages to do an initial set, but in the meantime, it will continue only with English.\nNext steps are:\nPromote messages marked as spam on groups into the general list (right now, messages marked as spam will be only stored, but no other work done with them) Once the message is promoted, it would be extracted from the database and put in an external CSV file similar to the SMS collection for the relevant language for future training. Use the list of blocked UID with status global, to warn in groups where that user is in, showing the chance to kick the user. spamcheck set to auto, automatically deletes the spam messages and reports the user, together with previous item, it will also auto-kick users Enjoy and happy filtering!\n","wordCount":"1514","inLanguage":"en","image":"https://iranzo.io/mugshot.png","datePublished":"2021-06-24T22:00:00+02:00","dateModified":"2023-08-25T09:46:05.162Z","author":{"@type":"Person","name":"Pablo Iranzo Gómez"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://iranzo.io/blog/2021/06/24/redken-machine-learning-for-spam-detection/"},"publisher":{"@type":"Organization","name":"Pablo Iranzo Gómez blog","logo":{"@type":"ImageObject","url":"https://iranzo.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://iranzo.io/ accesskey=h title="Home (Alt + H)"><img src=https://iranzo.io/apple-icon-152x152.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://iranzo.io/es/ title=Spanish aria-label=Spanish>Es</a></li></ul></div></div><ul id=menu><li><a href=https://iranzo.io/ title=🏠Home><span>🏠Home</span></a></li><li><a href=https://iranzo.io/about/ title=🗒️About><span>🗒️About</span></a></li><li><a href=https://iranzo.io/redken_bot/ title=🐘redken_bot><span>🐘redken_bot</span></a></li><li><a href=https://iranzo.io/projects/ title=📐Projects><span>📐Projects</span></a></li><li><a href=https://iranzo.io/archives/ title="🗄️ Archives"><span>🗄️ Archives</span></a></li><li><a href=https://iranzo.io/categories/ title=🗺️Categories><span>🗺️Categories</span></a></li><li><a href=https://iranzo.io/tags/ title=🏷️Tags><span>🏷️Tags</span></a></li><li><a href=https://iranzo.io/search title="🔎Search (Alt + /)" accesskey=/><span>🔎Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://iranzo.io/>Home</a>&nbsp;»&nbsp;<a href=https://iranzo.io/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">Redken machine learning for spam detection</h1><div class=post-meta><span title='2021-06-24 22:00:00 +0200 +0200'>June 24, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Pablo Iranzo Gómez</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-admin-detection aria-label="The admin detection">The admin detection</a></li><li><a href=#spam-actions aria-label="Spam actions">Spam actions</a></li><li><a href=#buttons-for-easier-usage aria-label="Buttons for easier usage">Buttons for easier usage</a></li><li><a href=#machine-learning aria-label="Machine learning">Machine learning</a></li></ul></div></details></div><div class=post-content><p>For some of the telegram groups I&rsquo;m in, I&rsquo;ve been detecting users that after some period of time, just publish spam messages of any topic.</p><p>There are many bots for controlling when a user joins, by showing a CAPTCHA that user must resolve (either clicking a button, answering a mathematical operation, inputting a CAPTCHA image text, etc).</p><p>Some time ago, a colleague was using Machine Learning and I wanted to have a look at it and it would make a good feature to implement.</p><p>First thing I wanted, was to get rid of the spammers, so the first approach was to include a new command on <a href=https://t.me/redken_bot>redken_bot</a> to mark with <code>/spam</code> when replying to a message to take some actions.</p><p>The <code>/spam</code> command also required some protection from abuse, so it should only work for admins.</p><h1 id=the-admin-detection>The admin detection<a hidden class=anchor aria-hidden=true href=#the-admin-detection>#</a></h1><p>In the beginning some of the commands added to <a href=https://t.me/redken_bot>redken_bot</a> had admin access that required the user to define the list of administrators via the <code>admin</code> configuration variable&mldr; but no one did.</p><p>With some changes in the telegram BOT API, the bot can get (when added as one of the admins in your group) the membership permission updates, so when a membership update arrives (new user added as admin or admin user becoming regular user), the bot will call the function to refresh the list of administrators and use it to update the <code>admin</code> variable automatically.</p><p>This required changing the way calls were made to get new telegram updates, but I enabled all the possible types of messages, as well as rewriting the function processing the data out of each message, but was a good improvement (even if invisible for outside users.)</p><h1 id=spam-actions>Spam actions<a hidden class=anchor aria-hidden=true href=#spam-actions>#</a></h1><p>Once the admin detection was solved and running (bot currently is member of 549 groups and has 28252 unique users, and only 20 groups have the admin variable set), the next step was to work on the spam actions.</p><p>Many times I was manually doing the stuff:</p><ul><li>Deleting message</li><li>Kicking user and reporting as spam</li><li>Sometimes even noting user UID to add to a blocklist</li></ul><p>So I decided to create a new command <code>/spam</code> which automates part of the job:</p><ul><li>Deletes message</li><li>Stores UID in the database as spammer</li><li>Kicks user out of the chat</li></ul><h1 id=buttons-for-easier-usage>Buttons for easier usage<a hidden class=anchor aria-hidden=true href=#buttons-for-easier-usage>#</a></h1><p>It would be great to have automatic detection, and easier reporting, so next step was playing a bit with buttons.</p><p>To be honest, never used them except for some attempts, but as I was playing with updated messages for the <code>admin</code> stuff, so was worth to use the feature that was there to add extra parameters to the call.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>yes <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Yes&#34;</span>
</span></span><span style=display:flex><span>no <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;No&#34;</span>
</span></span><span style=display:flex><span>ignore <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Ignore&#34;</span>
</span></span><span style=display:flex><span>isthisspammsg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Is this spam?&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>extra <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;reply_markup={&#34;inline_keyboard&#34;:[[{&#34;text&#34;:&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;,&#34;callback_data&#34;:&#34;SPAM&#34;},{&#34;text&#34;:&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;,&#34;callback_data&#34;:&#34;HAM&#34;},{&#34;text&#34;:&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;,&#34;callback_data&#34;:&#34;IGNORE&#34;}]]}&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>%</span> (yes, no, ignore)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>With above approach, the bot could reply to messages and attach an inline-keyboard with configurable buttons, returning as part of the callback data the message I wanted (<code>HAM</code>,<code>SPAM</code> or <code>IGNORE</code>).</p><p>This, also required to process the <code>callback_data</code> that we were now collecting since the changes added for the admin status change.</p><p>The good thing is that the answer provided when pressing the button, contains reference to the original message, so it was easier to later catch the text we were replying with the buttons.</p><h1 id=machine-learning>Machine learning<a hidden class=anchor aria-hidden=true href=#machine-learning>#</a></h1><p>Machine learning more or less, is showing data to an algorithm with results tagged in one or either way, divide the set of data between a training group and a test group and feed it to the algorithm to find how good it has been.</p><p>For doing so, it converts the input data into numbers and tries to find relationships between them. This also opens the pandora box as it has lot of different approaches, depending on the function being used for doing the conversion, for example, some of them use frequency of elements, removing the less frequent, etc</p><p>Finally, using the model the program can classify new data, based on the model that was elaborated, and in order to improve it, the data should be refreshed with new patterns for both cases: ham and spam so that it can continue evolving.</p><p>There are lot of documents about this, the shortest example I can think of is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> langdetect <span style=color:#f92672>import</span> detect
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> nltk.corpus <span style=color:#f92672>import</span> stopwords
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.feature_extraction.text <span style=color:#f92672>import</span> CountVectorizer
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.feature_extraction.text <span style=color:#f92672>import</span> TfidfTransformer
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> classification_report, confusion_matrix, accuracy_score
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.model_selection <span style=color:#f92672>import</span> train_test_split
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.naive_bayes <span style=color:#f92672>import</span> MultinomialNB
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.pipeline <span style=color:#f92672>import</span> Pipeline
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> nltk
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pickle
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> dill
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Downloading updated stopwords&#34;</span>)
</span></span><span style=display:flex><span>nltk<span style=color:#f92672>.</span>download(<span style=color:#e6db74>&#34;stopwords&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Starting training with on-disk databases&#34;</span>)
</span></span><span style=display:flex><span>message <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;spam/spam.</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>.csv&#34;</span> <span style=color:#f92672>%</span> language, sep<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;,&#34;</span>, names<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;Category&#34;</span>, <span style=color:#e6db74>&#34;Message&#34;</span>]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop duplicate messages</span>
</span></span><span style=display:flex><span>message<span style=color:#f92672>.</span>drop_duplicates(inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Split the messages between train and test</span>
</span></span><span style=display:flex><span>msg_train, msg_test, label_train, label_test <span style=color:#f92672>=</span> train_test_split(
</span></span><span style=display:flex><span>    message[<span style=color:#e6db74>&#34;Message&#34;</span>], message[<span style=color:#e6db74>&#34;Category&#34;</span>], test_size<span style=color:#f92672>=</span><span style=color:#ae81ff>0.2</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the function for our language</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pipeline <span style=color:#f92672>=</span> Pipeline(
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        (
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;bow&#34;</span>,
</span></span><span style=display:flex><span>            CountVectorizer(
</span></span><span style=display:flex><span>                analyzer<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> text: process_text(text, language<span style=color:#f92672>=</span>languages[language])
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#34;tfidf&#34;</span>, TfidfTransformer()),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#34;classifier&#34;</span>, MultinomialNB()),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Training the algorithm for language: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> language)
</span></span><span style=display:flex><span>pipeline<span style=color:#f92672>.</span>fit(msg_train, label_train)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Evaluate the model on the training data set</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Testing the training for language: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> language)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pred <span style=color:#f92672>=</span> pipeline<span style=color:#f92672>.</span>predict(msg_train)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Accuracy with train data&#34;</span>)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> classification_report(label_train, pred))
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Confusion Matrix:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> confusion_matrix(label_train, pred))
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Accuracy: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> accuracy_score(label_train, pred))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pred <span style=color:#f92672>=</span> pipeline<span style=color:#f92672>.</span>predict(msg_test)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Accuracy with test data&#34;</span>)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> classification_report(label_test, pred))
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Confusion Matrix:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> confusion_matrix(label_test, pred))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>accuracy <span style=color:#f92672>=</span> accuracy_score(label_test, pred)
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Accuracy: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> accuracy)
</span></span></code></pre></div><p>In short, this loads a know list of messages with spam and ham and divides it to train the model (via the pipeline) and later to test on the test data to check accuracy.</p><p>For doing so, it also downloads <code>stopwords</code>, which allows to remove junctions from phrases that are usually less meaningful of the message data itself. The <code>process_text</code> function defined in the pipeline is the one that we should write and takes care of removing punctuation, stopwords, etc.</p><p>Of course, training takes a while so it&rsquo;s not something you&rsquo;ll be doing in realtime, but there is where the <code>dill</code> library (that worked better for my use case than <code>pickle</code>) helped me&mldr; Bot trains every day for new language model, stores it on disk, and later is able to restore from disk and directly use it.</p><p>For saving and restoring we can use something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#75715e># Save trained pipeline</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(pkl_filename, <span style=color:#e6db74>&#34;wb&#34;</span>) <span style=color:#66d9ef>as</span> file:
</span></span><span style=display:flex><span>    dill<span style=color:#f92672>.</span>dump(pipeline, file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restore trained pipeline</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(pkl_filename, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> file:
</span></span><span style=display:flex><span>    pipeline <span style=color:#f92672>=</span> dill<span style=color:#f92672>.</span>load(file)
</span></span></code></pre></div><p>So, here we&rsquo;ve already all the pieces&mldr;</p><ul><li>We can train a pipeline with our database of spam</li><li>We can save and restore a pipeline so that we can do the hard work in easy moments and still have fast results when using it</li><li>We can report messages as spam manually and perform actions</li></ul><p>The last piece of glue, was extending the <code>/spam</code> command to also store the message received and marked as <code>spam</code> into the database.</p><p>With this approach, the bot is able to work on the current existing database to generate a model, and still allow to grow the database with admin-reported spam messages. Those messages will then be used to train the pipeline periodically either as training or test, helping improving and enhancing the detection</p><p>So the actual behavior is that <a href=https://t.me/redken_bot>@redken_bot</a> does:</p><ul><li>Checks new message if a model for that language exists (only saves it when accuracy is 85% or higher)<ul><li>If it&rsquo;s spam, It will show a keyboard to either mark as spam (confirm) or ignore the message</li></ul></li><li>Admins can reply with <code>/spam</code> to messages, even if there&rsquo;s no model for that language, helping in creating the database of messages</li><li>If a message has been marked as spam, either by replying with <code>/spam</code> or by clicking on the button saying that it&rsquo;s spam, the spam process begins:<ul><li>The button is always removed when replying (with the question about spam status)</li><li>If the message was marked as spam, the original message is removed<ul><li>The user that sent the message, gets added to the database as spammer and then kicked out of the chat</li><li>The message is stored on the database for future enhancement of the machine language detection.</li></ul></li></ul></li></ul><p>Additionally, I&rsquo;m testing a &lsquo;ham&rsquo; training feature, being fed with regular messages to start building a positive set of messages to compare with.</p><p>I will continue searching for spam databases in other languages to do an initial set, but in the meantime, it will continue only with English.</p><p>Next steps are:</p><ul><li>Promote messages marked as spam on groups into the general list (right now, messages marked as spam will be only stored, but no other work done with them)<ul><li>Once the message is promoted, it would be extracted from the database and put in an external CSV file similar to the SMS collection for the relevant language for future training.</li></ul></li><li>Use the list of blocked UID with status global, to warn in groups where that user is in, showing the chance to kick the user.</li><li><code>spamcheck</code> set to <code>auto</code>, automatically deletes the spam messages and reports the user, together with previous item, it will also auto-kick users</li></ul><p>Enjoy and happy filtering!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://iranzo.io/tags/foss/>FOSS</a></li><li><a href=https://iranzo.io/tags/telegram/>Telegram</a></li><li><a href=https://iranzo.io/tags/python/>Python</a></li><li><a href=https://iranzo.io/tags/programming/>Programming</a></li><li><a href=https://iranzo.io/tags/redken/>Redken</a></li><li><a href=https://iranzo.io/tags/scikit/>Scikit</a></li><li><a href=https://iranzo.io/tags/machine-learning/>Machine Learning</a></li><li><a href=https://iranzo.io/tags/ml/>ML</a></li></ul><nav class=paginav><a class=prev href=https://iranzo.io/blog/2021/07/01/uefi-boot-order-change/><span class=title>« Prev</span><br><span>UEFI boot order change</span>
</a><a class=next href=https://iranzo.io/blog/2021/06/12/geo-replication-with-syncthing/><span class=title>Next »</span><br><span>Geo replication with syncthing</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on x" href="https://x.com/intent/tweet/?text=Redken%20machine%20learning%20for%20spam%20detection&amp;url=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f&amp;hashtags=FOSS%2cTelegram%2cPython%2cprogramming%2credken%2cscikit%2cmachinelearning%2cML"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f&amp;title=Redken%20machine%20learning%20for%20spam%20detection&amp;summary=Redken%20machine%20learning%20for%20spam%20detection&amp;source=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on reddit" href="https://reddit.com/submit?url=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f&title=Redken%20machine%20learning%20for%20spam%20detection"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on whatsapp" href="https://api.whatsapp.com/send?text=Redken%20machine%20learning%20for%20spam%20detection%20-%20https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on telegram" href="https://telegram.me/share/url?text=Redken%20machine%20learning%20for%20spam%20detection&amp;url=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redken machine learning for spam detection on ycombinator" href="https://news.ycombinator.com/submitlink?t=Redken%20machine%20learning%20for%20spam%20detection&u=https%3a%2f%2firanzo.io%2fblog%2f2021%2f06%2f24%2fredken-machine-learning-for-spam-detection%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://iranzo.io/>Pablo Iranzo Gómez blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><center><small>This blog is a participant in the Amazon Associate Program, an affiliate advertising program designed to provide a means for sites to earn advertising fees by advertising and linking to Amazon.</small></center><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>